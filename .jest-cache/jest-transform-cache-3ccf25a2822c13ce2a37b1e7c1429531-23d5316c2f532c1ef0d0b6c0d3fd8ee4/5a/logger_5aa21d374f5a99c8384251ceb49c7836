2606629d80e0761ef96fdf39d867f025
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = void 0;
exports.createLogger = createLogger;
class Logger {
    constructor() {
        this.isDevelopment = process.env.NODE_ENV === 'development';
        this.minLevel = this.isDevelopment ? 'debug' : 'info';
        this.email = {
            sent: (type, recipient, subject, context) => {
                this.info(`Email sent: ${type}`, Object.assign({ type,
                    recipient,
                    subject, service: 'email' }, context));
            },
            failed: (type, recipient, error, context) => {
                this.error(`Email failed: ${type}`, error, Object.assign({ type,
                    recipient, service: 'email' }, context));
            },
            processing: (type, recipient, context) => {
                this.info(`Email processing: ${type}`, Object.assign({ type,
                    recipient, service: 'email' }, context));
            }
        };
        this.api = {
            request: (method, path, context) => {
                this.debug(`API Request: ${method} ${path}`, Object.assign({ method,
                    path, service: 'api' }, context));
            },
            response: (method, path, status, duration, context) => {
                const level = status >= 400 ? 'warn' : 'info';
                this.formatMessage(level, `API Response: ${method} ${path} - ${status}`, Object.assign({ method,
                    path,
                    status,
                    duration, service: 'api' }, context));
            },
            error: (method, path, error, context) => {
                this.error(`API Error: ${method} ${path}`, error, Object.assign({ method,
                    path, service: 'api' }, context));
            }
        };
        this.event = {
            created: (eventId, title, organizerId, context) => {
                this.info(`Event created: ${title}`, Object.assign({ eventId,
                    title,
                    organizerId, service: 'events' }, context));
            },
            updated: (eventId, title, changes, context) => {
                this.info(`Event updated: ${title}`, Object.assign({ eventId,
                    title,
                    changes, service: 'events' }, context));
            },
            deleted: (eventId, title, context) => {
                this.warn(`Event deleted: ${title}`, Object.assign({ eventId,
                    title, service: 'events' }, context));
            }
        };
        this.payment = {
            initiated: (orderId, amount, currency, context) => {
                this.info(`Payment initiated`, Object.assign({ orderId,
                    amount,
                    currency, service: 'payment' }, context));
            },
            completed: (orderId, amount, currency, context) => {
                this.info(`Payment completed`, Object.assign({ orderId,
                    amount,
                    currency, service: 'payment' }, context));
            },
            failed: (orderId, error, context) => {
                this.error(`Payment failed`, error, Object.assign({ orderId, service: 'payment' }, context));
            }
        };
    }
    levelToNumber(level) {
        const levels = { debug: 0, info: 1, warn: 2, error: 3 };
        return levels[level];
    }
    shouldLog(level) {
        return this.levelToNumber(level) >= this.levelToNumber(this.minLevel);
    }
    formatMessage(level, message, context, error) {
        if (!this.shouldLog(level))
            return;
        const timestamp = new Date().toISOString();
        const logEntry = {
            timestamp,
            level,
            message,
            context,
            error
        };
        if (this.isDevelopment) {
            const emoji = { debug: 'ðŸ”', info: 'â„¹ï¸', warn: 'âš ï¸', error: 'âŒ' }[level];
            const color = { debug: '\x1b[36m', info: '\x1b[32m', warn: '\x1b[33m', error: '\x1b[31m' }[level];
            const reset = '\x1b[0m';
            console.log(`${color}${emoji} [${level.toUpperCase()}]${reset} ${message}`);
            if (context && Object.keys(context).length > 0) {
                console.log(`${color}   Context:${reset}`, context);
            }
            if (error) {
                console.error(`${color}   Error:${reset}`, error);
            }
        }
        else {
            console.log(JSON.stringify(logEntry));
        }
    }
    debug(message, context) {
        this.formatMessage('debug', message, context);
    }
    info(message, context) {
        this.formatMessage('info', message, context);
    }
    warn(message, context) {
        this.formatMessage('warn', message, context);
    }
    error(message, error, context) {
        this.formatMessage('error', message, context, error);
    }
}
exports.logger = new Logger();
function createLogger(defaultContext) {
    return {
        debug: (message, context) => exports.logger.debug(message, Object.assign(Object.assign({}, defaultContext), context)),
        info: (message, context) => exports.logger.info(message, Object.assign(Object.assign({}, defaultContext), context)),
        warn: (message, context) => exports.logger.warn(message, Object.assign(Object.assign({}, defaultContext), context)),
        error: (message, error, context) => exports.logger.error(message, error, Object.assign(Object.assign({}, defaultContext), context)),
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxsaWJcXGxvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFtTkEsb0NBV0M7QUExTUQsTUFBTSxNQUFNO0lBQVo7UUFDVSxrQkFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQztRQUN2RCxhQUFRLEdBQWEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7UUEyRG5FLFVBQUssR0FBRztZQUNOLElBQUksRUFBRSxDQUFDLElBQVksRUFBRSxTQUFpQixFQUFFLE9BQWUsRUFBRSxPQUFvQixFQUFFLEVBQUU7Z0JBQy9FLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxJQUFJLEVBQUUsa0JBQzdCLElBQUk7b0JBQ0osU0FBUztvQkFDVCxPQUFPLEVBQ1AsT0FBTyxFQUFFLE9BQU8sSUFDYixPQUFPLEVBQ1YsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLEVBQUUsQ0FBQyxJQUFZLEVBQUUsU0FBaUIsRUFBRSxLQUFZLEVBQUUsT0FBb0IsRUFBRSxFQUFFO2dCQUM5RSxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixJQUFJLEVBQUUsRUFBRSxLQUFLLGtCQUN2QyxJQUFJO29CQUNKLFNBQVMsRUFDVCxPQUFPLEVBQUUsT0FBTyxJQUNiLE9BQU8sRUFDVixDQUFDO1lBQ0wsQ0FBQztZQUVELFVBQVUsRUFBRSxDQUFDLElBQVksRUFBRSxTQUFpQixFQUFFLE9BQW9CLEVBQUUsRUFBRTtnQkFDcEUsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxFQUFFLGtCQUNuQyxJQUFJO29CQUNKLFNBQVMsRUFDVCxPQUFPLEVBQUUsT0FBTyxJQUNiLE9BQU8sRUFDVixDQUFDO1lBQ0wsQ0FBQztTQUNGLENBQUM7UUFHRixRQUFHLEdBQUc7WUFDSixPQUFPLEVBQUUsQ0FBQyxNQUFj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LEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdkQsQ0FBQztDQWdJRjtBQUVZLFFBQUEsTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFHbkMsU0FBZ0IsWUFBWSxDQUFDLGNBQTBCO0lBQ3JELE9BQU87UUFDTCxLQUFLLEVBQUUsQ0FBQyxPQUFlLEVBQUUsT0FBb0IsRUFBRSxFQUFFLENBQy9DLGNBQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxrQ0FBTyxjQUFjLEdBQUssT0FBTyxFQUFHO1FBQzFELElBQUksRUFBRSxDQUFDLE9BQWUsRUFBRSxPQUFvQixFQUFFLEVBQUUsQ0FDOUMsY0FBTSxDQUFDLElBQUksQ0FBQyxPQUFPLGtDQUFPLGNBQWMsR0FBSyxPQUFPLEVBQUc7UUFDekQsSUFBSSxFQUFFLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsRUFBRSxDQUM5QyxjQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sa0NBQU8sY0FBYyxHQUFLLE9BQU8sRUFBRztRQUN6RCxLQUFLLEVBQUUsQ0FBQyxPQUFlLEVBQUUsS0FBYSxFQUFFLE9BQW9CLEVBQUUsRUFBRSxDQUM5RCxjQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLGtDQUFPLGNBQWMsR0FBSyxPQUFPLEVBQUc7S0FDbEUsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxsaWJcXGxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcbmV4cG9ydCB0eXBlIExvZ0xldmVsID0gJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvZ0NvbnRleHQge1xyXG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XHJcbiAgdXNlcklkPzogc3RyaW5nO1xyXG4gIGV2ZW50SWQ/OiBzdHJpbmc7XHJcbiAgcmVxdWVzdElkPzogc3RyaW5nO1xyXG4gIHNlcnZpY2U/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTG9nRW50cnkge1xyXG4gIHRpbWVzdGFtcDogc3RyaW5nO1xyXG4gIGxldmVsOiBMb2dMZXZlbDtcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgY29udGV4dD86IExvZ0NvbnRleHQ7XHJcbiAgZXJyb3I/OiBFcnJvcjtcclxufVxyXG5cclxuY2xhc3MgTG9nZ2VyIHtcclxuICBwcml2YXRlIGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcclxuICBwcml2YXRlIG1pbkxldmVsOiBMb2dMZXZlbCA9IHRoaXMuaXNEZXZlbG9wbWVudCA/ICdkZWJ1ZycgOiAnaW5mbyc7XHJcblxyXG4gIHByaXZhdGUgbGV2ZWxUb051bWJlcihsZXZlbDogTG9nTGV2ZWwpOiBudW1iZXIge1xyXG4gICAgY29uc3QgbGV2ZWxzID0geyBkZWJ1ZzogMCwgaW5mbzogMSwgd2FybjogMiwgZXJyb3I6IDMgfTtcclxuICAgIHJldHVybiBsZXZlbHNbbGV2ZWxdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG91bGRMb2cobGV2ZWw6IExvZ0xldmVsKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5sZXZlbFRvTnVtYmVyKGxldmVsKSA+PSB0aGlzLmxldmVsVG9OdW1iZXIodGhpcy5taW5MZXZlbCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZvcm1hdE1lc3NhZ2UobGV2ZWw6IExvZ0xldmVsLCBtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBlcnJvcj86IEVycm9yKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuc2hvdWxkTG9nKGxldmVsKSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICAgIGNvbnN0IGxvZ0VudHJ5OiBMb2dFbnRyeSA9IHtcclxuICAgICAgdGltZXN0YW1wLFxyXG4gICAgICBsZXZlbCxcclxuICAgICAgbWVzc2FnZSxcclxuICAgICAgY29udGV4dCxcclxuICAgICAgZXJyb3JcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHRoaXMuaXNEZXZlbG9wbWVudCkge1xyXG4gICAgICBcbiAgICAgIGNvbnN0IGVtb2ppID0geyBkZWJ1ZzogJ/CflI0nLCBpbmZvOiAn4oS577iPJywgd2FybjogJ+KaoO+4jycsIGVycm9yOiAn4p2MJyB9W2xldmVsXTtcclxuICAgICAgY29uc3QgY29sb3IgPSB7IGRlYnVnOiAnXFx4MWJbMzZtJywgaW5mbzogJ1xceDFiWzMybScsIHdhcm46ICdcXHgxYlszM20nLCBlcnJvcjogJ1xceDFiWzMxbScgfVtsZXZlbF07XHJcbiAgICAgIGNvbnN0IHJlc2V0ID0gJ1xceDFiWzBtJztcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGAke2NvbG9yfSR7ZW1vaml9IFske2xldmVsLnRvVXBwZXJDYXNlKCl9XSR7cmVzZXR9ICR7bWVzc2FnZX1gKTtcclxuICAgICAgaWYgKGNvbnRleHQgJiYgT2JqZWN0LmtleXMoY29udGV4dCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAke2NvbG9yfSAgIENvbnRleHQ6JHtyZXNldH1gLCBjb250ZXh0KTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGAke2NvbG9yfSAgIEVycm9yOiR7cmVzZXR9YCwgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGxvZ0VudHJ5KSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZCB7XHJcbiAgICB0aGlzLmZvcm1hdE1lc3NhZ2UoJ2RlYnVnJywgbWVzc2FnZSwgY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkIHtcclxuICAgIHRoaXMuZm9ybWF0TWVzc2FnZSgnaW5mbycsIG1lc3NhZ2UsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZCB7XHJcbiAgICB0aGlzLmZvcm1hdE1lc3NhZ2UoJ3dhcm4nLCBtZXNzYWdlLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgZXJyb3I/OiBFcnJvciwgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkIHtcclxuICAgIHRoaXMuZm9ybWF0TWVzc2FnZSgnZXJyb3InLCBtZXNzYWdlLCBjb250ZXh0LCBlcnJvcik7XHJcbiAgfVxyXG5cclxuICBcbiAgZW1haWwgPSB7XHJcbiAgICBzZW50OiAodHlwZTogc3RyaW5nLCByZWNpcGllbnQ6IHN0cmluZywgc3ViamVjdDogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICB0aGlzLmluZm8oYEVtYWlsIHNlbnQ6ICR7dHlwZX1gLCB7XHJcbiAgICAgICAgdHlwZSxcclxuICAgICAgICByZWNpcGllbnQsXHJcbiAgICAgICAgc3ViamVjdCxcclxuICAgICAgICBzZXJ2aWNlOiAnZW1haWwnLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGZhaWxlZDogKHR5cGU6IHN0cmluZywgcmVjaXBpZW50OiBzdHJpbmcsIGVycm9yOiBFcnJvciwgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgICAgdGhpcy5lcnJvcihgRW1haWwgZmFpbGVkOiAke3R5cGV9YCwgZXJyb3IsIHtcclxuICAgICAgICB0eXBlLFxyXG4gICAgICAgIHJlY2lwaWVudCxcclxuICAgICAgICBzZXJ2aWNlOiAnZW1haWwnLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHByb2Nlc3Npbmc6ICh0eXBlOiBzdHJpbmcsIHJlY2lwaWVudDogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICB0aGlzLmluZm8oYEVtYWlsIHByb2Nlc3Npbmc6ICR7dHlwZX1gLCB7XHJcbiAgICAgICAgdHlwZSxcclxuICAgICAgICByZWNpcGllbnQsXHJcbiAgICAgICAgc2VydmljZTogJ2VtYWlsJyxcclxuICAgICAgICAuLi5jb250ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIFxuICBhcGkgPSB7XHJcbiAgICByZXF1ZXN0OiAobWV0aG9kOiBzdHJpbmcsIHBhdGg6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgICAgdGhpcy5kZWJ1ZyhgQVBJIFJlcXVlc3Q6ICR7bWV0aG9kfSAke3BhdGh9YCwge1xyXG4gICAgICAgIG1ldGhvZCxcclxuICAgICAgICBwYXRoLFxyXG4gICAgICAgIHNlcnZpY2U6ICdhcGknLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlc3BvbnNlOiAobWV0aG9kOiBzdHJpbmcsIHBhdGg6IHN0cmluZywgc3RhdHVzOiBudW1iZXIsIGR1cmF0aW9uPzogbnVtYmVyLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICBjb25zdCBsZXZlbCA9IHN0YXR1cyA+PSA0MDAgPyAnd2FybicgOiAnaW5mbyc7XHJcbiAgICAgIHRoaXMuZm9ybWF0TWVzc2FnZShsZXZlbCwgYEFQSSBSZXNwb25zZTogJHttZXRob2R9ICR7cGF0aH0gLSAke3N0YXR1c31gLCB7XHJcbiAgICAgICAgbWV0aG9kLFxyXG4gICAgICAgIHBhdGgsXHJcbiAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgIGR1cmF0aW9uLFxyXG4gICAgICAgIHNlcnZpY2U6ICdhcGknLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVycm9yOiAobWV0aG9kOiBzdHJpbmcsIHBhdGg6IHN0cmluZywgZXJyb3I6IEVycm9yLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICB0aGlzLmVycm9yKGBBUEkgRXJyb3I6ICR7bWV0aG9kfSAke3BhdGh9YCwgZXJyb3IsIHtcclxuICAgICAgICBtZXRob2QsXHJcbiAgICAgICAgcGF0aCxcclxuICAgICAgICBzZXJ2aWNlOiAnYXBpJyxcclxuICAgICAgICAuLi5jb250ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIFxuICBldmVudCA9IHtcclxuICAgIGNyZWF0ZWQ6IChldmVudElkOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIG9yZ2FuaXplcklkOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KSA9PiB7XHJcbiAgICAgIHRoaXMuaW5mbyhgRXZlbnQgY3JlYXRlZDogJHt0aXRsZX1gLCB7XHJcbiAgICAgICAgZXZlbnRJZCxcclxuICAgICAgICB0aXRsZSxcclxuICAgICAgICBvcmdhbml6ZXJJZCxcclxuICAgICAgICBzZXJ2aWNlOiAnZXZlbnRzJyxcclxuICAgICAgICAuLi5jb250ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVkOiAoZXZlbnRJZDogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCBjaGFuZ2VzOiBzdHJpbmdbXSwgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgICAgdGhpcy5pbmZvKGBFdmVudCB1cGRhdGVkOiAke3RpdGxlfWAsIHtcclxuICAgICAgICBldmVudElkLFxyXG4gICAgICAgIHRpdGxlLFxyXG4gICAgICAgIGNoYW5nZXMsXHJcbiAgICAgICAgc2VydmljZTogJ2V2ZW50cycsXHJcbiAgICAgICAgLi4uY29udGV4dFxyXG4gICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgZGVsZXRlZDogKGV2ZW50SWQ6IHN0cmluZywgdGl0bGU6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgICAgdGhpcy53YXJuKGBFdmVudCBkZWxldGVkOiAke3RpdGxlfWAsIHtcclxuICAgICAgICBldmVudElkLFxyXG4gICAgICAgIHRpdGxlLFxyXG4gICAgICAgIHNlcnZpY2U6ICdldmVudHMnLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgXG4gIHBheW1lbnQgPSB7XHJcbiAgICBpbml0aWF0ZWQ6IChvcmRlcklkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyLCBjdXJyZW5jeTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICB0aGlzLmluZm8oYFBheW1lbnQgaW5pdGlhdGVkYCwge1xyXG4gICAgICAgIG9yZGVySWQsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIGN1cnJlbmN5LFxyXG4gICAgICAgIHNlcnZpY2U6ICdwYXltZW50JyxcclxuICAgICAgICAuLi5jb250ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBjb21wbGV0ZWQ6IChvcmRlcklkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyLCBjdXJyZW5jeTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgICB0aGlzLmluZm8oYFBheW1lbnQgY29tcGxldGVkYCwge1xyXG4gICAgICAgIG9yZGVySWQsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIGN1cnJlbmN5LFxyXG4gICAgICAgIHNlcnZpY2U6ICdwYXltZW50JyxcclxuICAgICAgICAuLi5jb250ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBmYWlsZWQ6IChvcmRlcklkOiBzdHJpbmcsIGVycm9yOiBFcnJvciwgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgICAgdGhpcy5lcnJvcihgUGF5bWVudCBmYWlsZWRgLCBlcnJvciwge1xyXG4gICAgICAgIG9yZGVySWQsXHJcbiAgICAgICAgc2VydmljZTogJ3BheW1lbnQnLFxyXG4gICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcclxuXHJcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUxvZ2dlcihkZWZhdWx0Q29udGV4dDogTG9nQ29udGV4dCkge1xyXG4gIHJldHVybiB7XHJcbiAgICBkZWJ1ZzogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpID0+IFxyXG4gICAgICBsb2dnZXIuZGVidWcobWVzc2FnZSwgeyAuLi5kZWZhdWx0Q29udGV4dCwgLi4uY29udGV4dCB9KSxcclxuICAgIGluZm86IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KSA9PiBcclxuICAgICAgbG9nZ2VyLmluZm8obWVzc2FnZSwgeyAuLi5kZWZhdWx0Q29udGV4dCwgLi4uY29udGV4dCB9KSxcclxuICAgIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KSA9PiBcclxuICAgICAgbG9nZ2VyLndhcm4obWVzc2FnZSwgeyAuLi5kZWZhdWx0Q29udGV4dCwgLi4uY29udGV4dCB9KSxcclxuICAgIGVycm9yOiAobWVzc2FnZTogc3RyaW5nLCBlcnJvcj86IEVycm9yLCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4gXHJcbiAgICAgIGxvZ2dlci5lcnJvcihtZXNzYWdlLCBlcnJvciwgeyAuLi5kZWZhdWx0Q29udGV4dCwgLi4uY29udGV4dCB9KSxcclxuICB9O1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==