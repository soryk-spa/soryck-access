4651f676ecb20a9fdef691a021270946
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getTimeUntil = exports.getRelativeDateDescription = exports.isTomorrow = exports.isToday = exports.formatShortDate = exports.formatTime = exports.formatDate = exports.formatFullDateTime = void 0;
exports.parseChileDatetime = parseChileDatetime;
exports.formatToChileDatetimeLocal = formatToChileDatetimeLocal;
exports.toChileISOString = toChileISOString;
exports.isFutureDate = isFutureDate;
exports.isValidDateRange = isValidDateRange;
exports.formatDisplayDate = formatDisplayDate;
exports.formatDisplayDateTime = formatDisplayDateTime;
exports.formatDisplayTime = formatDisplayTime;
exports.getCurrentChileDate = getCurrentChileDate;
exports.fromTimestamp = fromTimestamp;
function parseChileDatetime(datetimeLocal) {
    if (!datetimeLocal) {
        throw new Error('Fecha requerida');
    }
    const date = new Date(datetimeLocal);
    if (isNaN(date.getTime())) {
        throw new Error('Fecha inválida');
    }
    return date;
}
function formatToChileDatetimeLocal(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    if (isNaN(dateObj.getTime())) {
        return '';
    }
    const chileDate = new Date(dateObj.toLocaleString("en-US", { timeZone: "America/Santiago" }));
    const year = chileDate.getFullYear();
    const month = String(chileDate.getMonth() + 1).padStart(2, '0');
    const day = String(chileDate.getDate()).padStart(2, '0');
    const hours = String(chileDate.getHours()).padStart(2, '0');
    const minutes = String(chileDate.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day}T${hours}:${minutes}`;
}
function toChileISOString(date) {
    return date.toISOString();
}
function isFutureDate(date) {
    const now = new Date();
    return date > now;
}
function isValidDateRange(startDate, endDate) {
    return endDate > startDate;
}
function formatDisplayDate(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleDateString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        timeZone: "America/Santiago",
    });
}
function formatDisplayDateTime(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
}
function formatDisplayTime(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleTimeString("es-CL", {
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
}
function getCurrentChileDate() {
    return new Date(new Date().toLocaleString("en-US", { timeZone: "America/Santiago" }));
}
function fromTimestamp(timestamp) {
    const ms = timestamp.toString().length === 10 ? timestamp * 1000 : timestamp;
    return new Date(ms);
}
const formatFullDateTime = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
};
exports.formatFullDateTime = formatFullDateTime;
const formatDate = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleDateString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        timeZone: "America/Santiago",
    });
};
exports.formatDate = formatDate;
const formatTime = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleTimeString("es-CL", {
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
};
exports.formatTime = formatTime;
const formatShortDate = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleDateString("es-CL", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        timeZone: "America/Santiago",
    });
};
exports.formatShortDate = formatShortDate;
const isToday = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    const today = new Date();
    return dateObj.toDateString() === today.toDateString();
};
exports.isToday = isToday;
const isTomorrow = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    return dateObj.toDateString() === tomorrow.toDateString();
};
exports.isTomorrow = isTomorrow;
const getRelativeDateDescription = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    if ((0, exports.isToday)(dateObj))
        return "Hoy";
    if ((0, exports.isTomorrow)(dateObj))
        return "Mañana";
    const now = new Date();
    const diffTime = dateObj.getTime() - now.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    if (diffDays < 0) {
        return diffDays === -1 ? "Ayer" : `Hace ${Math.abs(diffDays)} días`;
    }
    else if (diffDays <= 7) {
        return `En ${diffDays} días`;
    }
    else {
        return (0, exports.formatDate)(dateObj);
    }
};
exports.getRelativeDateDescription = getRelativeDateDescription;
const getTimeUntil = (date) => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    const now = new Date();
    const diffTime = dateObj.getTime() - now.getTime();
    if (diffTime <= 0) {
        return { days: 0, hours: 0, minutes: 0, isExpired: true };
    }
    const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
    return { days, hours, minutes, isExpired: false };
};
exports.getTimeUntil = getTimeUntil;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxsaWJcXGRhdGUtdXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBSUEsZ0RBY0M7QUFHRCxnRUFpQkM7QUFHRCw0Q0FFQztBQUdELG9DQUdDO0FBR0QsNENBRUM7QUFHRCw4Q0FVQztBQUdELHNEQVlDO0FBR0QsOENBUUM7QUFHRCxrREFFQztBQUdELHNDQUlDO0FBckdELFNBQWdCLGtCQUFrQixDQUFDLGFBQXFCO0lBQ3RELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDckMsQ0FBQztJQUdELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBR3JDLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFHRCxTQUFnQiwwQkFBMEIsQ0FBQyxJQUFtQjtJQUM1RCxNQUFNLE9BQU8sR0FBRyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFFakUsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFHRCxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUU5RixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsV0FBVyxFQUFFLENB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RyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEYsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRXhFLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUM7QUFDcEQsQ0FBQyxDQUFDO0FBbkJXLFFBQUEsWUFBWSxnQkFtQnZCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQmlsdXJcXERvY3VtZW50c1xcRGV2ZWxvcG1lbnRcXE5leHRcXHNvcnljay1hY2Nlc3NcXHNyY1xcbGliXFxkYXRlLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDaGlsZURhdGV0aW1lKGRhdGV0aW1lTG9jYWw6IHN0cmluZyk6IERhdGUge1xyXG4gIGlmICghZGF0ZXRpbWVMb2NhbCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdGZWNoYSByZXF1ZXJpZGEnKTtcclxuICB9XHJcblxyXG4gIFxyXG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRldGltZUxvY2FsKTtcclxuICBcclxuICBcclxuICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZlY2hhIGludsOhbGlkYScpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRhdGU7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0VG9DaGlsZURhdGV0aW1lTG9jYWwoZGF0ZTogRGF0ZSB8IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBcclxuICBpZiAoaXNOYU4oZGF0ZU9iai5nZXRUaW1lKCkpKSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICBcclxuICBjb25zdCBjaGlsZURhdGUgPSBuZXcgRGF0ZShkYXRlT2JqLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZTogXCJBbWVyaWNhL1NhbnRpYWdvXCIgfSkpO1xyXG4gIFxyXG4gIGNvbnN0IHllYXIgPSBjaGlsZURhdGUuZ2V0RnVsbFllYXIoKTtcclxuICBjb25zdCBtb250aCA9IFN0cmluZyhjaGlsZURhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbiAgY29uc3QgZGF5ID0gU3RyaW5nKGNoaWxlRGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbiAgY29uc3QgaG91cnMgPSBTdHJpbmcoY2hpbGVEYXRlLmdldEhvdXJzKCkpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbiAgY29uc3QgbWludXRlcyA9IFN0cmluZyhjaGlsZURhdGUuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCAnMCcpO1xyXG5cclxuICByZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9VCR7aG91cnN9OiR7bWludXRlc31gO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvQ2hpbGVJU09TdHJpbmcoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0Z1dHVyZURhdGUoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgcmV0dXJuIGRhdGUgPiBub3c7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZERhdGVSYW5nZShzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBib29sZWFuIHtcclxuICByZXR1cm4gZW5kRGF0ZSA+IHN0YXJ0RGF0ZTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREaXNwbGF5RGF0ZShkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvTG9jYWxlRGF0ZVN0cmluZyhcImVzLUNMXCIsIHtcclxuICAgIHdlZWtkYXk6IFwibG9uZ1wiLFxyXG4gICAgeWVhcjogXCJudW1lcmljXCIsXHJcbiAgICBtb250aDogXCJsb25nXCIsXHJcbiAgICBkYXk6IFwibnVtZXJpY1wiLFxyXG4gICAgdGltZVpvbmU6IFwiQW1lcmljYS9TYW50aWFnb1wiLFxyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERpc3BsYXlEYXRlVGltZShkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvTG9jYWxlU3RyaW5nKFwiZXMtQ0xcIiwge1xyXG4gICAgd2Vla2RheTogXCJsb25nXCIsXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIG1vbnRoOiBcImxvbmdcIixcclxuICAgIGRheTogXCJudW1lcmljXCIsXHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICB0aW1lWm9uZTogXCJBbWVyaWNhL1NhbnRpYWdvXCIsXHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGlzcGxheVRpbWUoZGF0ZTogRGF0ZSB8IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBcclxuICByZXR1cm4gZGF0ZU9iai50b0xvY2FsZVRpbWVTdHJpbmcoXCJlcy1DTFwiLCB7XHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICB0aW1lWm9uZTogXCJBbWVyaWNhL1NhbnRpYWdvXCIsXHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudENoaWxlRGF0ZSgpOiBEYXRlIHtcclxuICByZXR1cm4gbmV3IERhdGUobmV3IERhdGUoKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmU6IFwiQW1lcmljYS9TYW50aWFnb1wiIH0pKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tVGltZXN0YW1wKHRpbWVzdGFtcDogbnVtYmVyKTogRGF0ZSB7XHJcbiAgXHJcbiAgY29uc3QgbXMgPSB0aW1lc3RhbXAudG9TdHJpbmcoKS5sZW5ndGggPT09IDEwID8gdGltZXN0YW1wICogMTAwMCA6IHRpbWVzdGFtcDtcclxuICByZXR1cm4gbmV3IERhdGUobXMpO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1hdEZ1bGxEYXRlVGltZSA9IChkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nID0+IHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvTG9jYWxlU3RyaW5nKFwiZXMtQ0xcIiwge1xyXG4gICAgd2Vla2RheTogXCJsb25nXCIsXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIG1vbnRoOiBcImxvbmdcIixcclxuICAgIGRheTogXCJudW1lcmljXCIsXHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICB0aW1lWm9uZTogXCJBbWVyaWNhL1NhbnRpYWdvXCIsXHJcbiAgfSk7XHJcbn07XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGUgPSAoZGF0ZTogRGF0ZSB8IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBcclxuICByZXR1cm4gZGF0ZU9iai50b0xvY2FsZURhdGVTdHJpbmcoXCJlcy1DTFwiLCB7XHJcbiAgICB3ZWVrZGF5OiBcImxvbmdcIixcclxuICAgIHllYXI6IFwibnVtZXJpY1wiLFxyXG4gICAgbW9udGg6IFwibG9uZ1wiLFxyXG4gICAgZGF5OiBcIm51bWVyaWNcIixcclxuICAgIHRpbWVab25lOiBcIkFtZXJpY2EvU2FudGlhZ29cIixcclxuICB9KTtcclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZm9ybWF0VGltZSA9IChkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nID0+IHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvTG9jYWxlVGltZVN0cmluZyhcImVzLUNMXCIsIHtcclxuICAgIGhvdXI6IFwiMi1kaWdpdFwiLFxyXG4gICAgbWludXRlOiBcIjItZGlnaXRcIixcclxuICAgIHRpbWVab25lOiBcIkFtZXJpY2EvU2FudGlhZ29cIixcclxuICB9KTtcclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZm9ybWF0U2hvcnREYXRlID0gKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBzdHJpbmcgPT4ge1xyXG4gIGNvbnN0IGRhdGVPYmogPSB0eXBlb2YgZGF0ZSA9PT0gJ3N0cmluZycgPyBuZXcgRGF0ZShkYXRlKSA6IGRhdGU7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGVPYmoudG9Mb2NhbGVEYXRlU3RyaW5nKFwiZXMtQ0xcIiwge1xyXG4gICAgZGF5OiBcIjItZGlnaXRcIixcclxuICAgIG1vbnRoOiBcIjItZGlnaXRcIiwgXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIHRpbWVab25lOiBcIkFtZXJpY2EvU2FudGlhZ29cIixcclxuICB9KTtcclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgaXNUb2RheSA9IChkYXRlOiBEYXRlIHwgc3RyaW5nKTogYm9vbGVhbiA9PiB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGVPYmoudG9EYXRlU3RyaW5nKCkgPT09IHRvZGF5LnRvRGF0ZVN0cmluZygpO1xyXG59O1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBpc1RvbW9ycm93ID0gKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBib29sZWFuID0+IHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUoKTtcclxuICB0b21vcnJvdy5zZXREYXRlKHRvbW9ycm93LmdldERhdGUoKSArIDEpO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvRGF0ZVN0cmluZygpID09PSB0b21vcnJvdy50b0RhdGVTdHJpbmcoKTtcclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0UmVsYXRpdmVEYXRlRGVzY3JpcHRpb24gPSAoZGF0ZTogRGF0ZSB8IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBcclxuICBpZiAoaXNUb2RheShkYXRlT2JqKSkgcmV0dXJuIFwiSG95XCI7XHJcbiAgaWYgKGlzVG9tb3Jyb3coZGF0ZU9iaikpIHJldHVybiBcIk1hw7FhbmFcIjtcclxuICBcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IGRpZmZUaW1lID0gZGF0ZU9iai5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpO1xyXG4gIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcclxuICBcclxuICBpZiAoZGlmZkRheXMgPCAwKSB7XHJcbiAgICByZXR1cm4gZGlmZkRheXMgPT09IC0xID8gXCJBeWVyXCIgOiBgSGFjZSAke01hdGguYWJzKGRpZmZEYXlzKX0gZMOtYXNgO1xyXG4gIH0gZWxzZSBpZiAoZGlmZkRheXMgPD0gNykge1xyXG4gICAgcmV0dXJuIGBFbiAke2RpZmZEYXlzfSBkw61hc2A7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGVPYmopO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0VGltZVVudGlsID0gKGRhdGU6IERhdGUgfCBzdHJpbmcpOiB7XHJcbiAgZGF5czogbnVtYmVyO1xyXG4gIGhvdXJzOiBudW1iZXI7XHJcbiAgbWludXRlczogbnVtYmVyO1xyXG4gIGlzRXhwaXJlZDogYm9vbGVhbjtcclxufSA9PiB7XHJcbiAgY29uc3QgZGF0ZU9iaiA9IHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKGRhdGUpIDogZGF0ZTtcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IGRpZmZUaW1lID0gZGF0ZU9iai5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpO1xyXG4gIFxyXG4gIGlmIChkaWZmVGltZSA8PSAwKSB7XHJcbiAgICByZXR1cm4geyBkYXlzOiAwLCBob3VyczogMCwgbWludXRlczogMCwgaXNFeHBpcmVkOiB0cnVlIH07XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcclxuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoKGRpZmZUaW1lICUgKDEwMDAgKiA2MCAqIDYwICogMjQpKSAvICgxMDAwICogNjAgKiA2MCkpO1xyXG4gIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKChkaWZmVGltZSAlICgxMDAwICogNjAgKiA2MCkpIC8gKDEwMDAgKiA2MCkpO1xyXG4gIFxyXG4gIHJldHVybiB7IGRheXMsIGhvdXJzLCBtaW51dGVzLCBpc0V4cGlyZWQ6IGZhbHNlIH07XHJcbn07Il0sInZlcnNpb24iOjN9