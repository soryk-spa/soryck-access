ce3ea0876640661303d5388fc131dc02
"use strict";
/**
 * Tests para las funcionalidades de compartir códigos promocionales
 * Tests simplificados que no dependen de hooks de React
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock toast
jest.mock('sonner');
const sonner_1 = require("sonner");
const mockToast = sonner_1.toast;
// Mock navigator clipboard
Object.assign(navigator, {
    clipboard: {
        writeText: jest.fn().mockImplementation(() => Promise.resolve()),
    },
    share: jest.fn().mockImplementation(() => Promise.resolve()),
});
// Mock PromoCode data
const mockPromoCodes = [
    {
        id: '1',
        code: 'SUMMER2024',
        name: 'Descuento de Verano',
        type: 'PERCENTAGE',
        value: 20,
        status: 'ACTIVE',
        usedCount: 25,
        usageLimit: 100,
        currency: 'CLP',
        validFrom: '2024-01-01',
        validUntil: '2024-12-31',
    },
    {
        id: '2',
        code: 'FIXED10K',
        name: 'Descuento Fijo',
        type: 'FIXED_AMOUNT',
        value: 10000,
        status: 'INACTIVE',
        usedCount: 50,
        usageLimit: 50,
        currency: 'CLP',
        validFrom: '2024-01-01',
        validUntil: '2024-06-30',
    },
];
describe('Funcionalidades de Compartir Códigos Promocionales', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('Compartir con Web Share API', () => {
        it('comparte código promocional con Web Share API disponible', async () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            const code = mockPromoCodes[0];
            const shareText = `🎫 ¡Descuento especial! Usa el código ${code.code} y obtén ${formatDiscount(code.type, code.value)} en tu próxima compra.`;
            if (navigator.share) {
                await navigator.share({
                    title: `Código promocional: ${code.name}`,
                    text: shareText,
                });
            }
            expect(navigator.share).toHaveBeenCalledWith({
                title: 'Código promocional: Descuento de Verano',
                text: '🎫 ¡Descuento especial! Usa el código SUMMER2024 y obtén 20% en tu próxima compra.',
            });
        });
        it('usa clipboard como fallback cuando no hay Web Share API', async () => {
            // Temporalmente eliminar Web Share API
            const originalShare = navigator.share;
            delete navigator.share;
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            const code = mockPromoCodes[0];
            const shareText = `🎫 ¡Descuento especial! Usa el código ${code.code} y obtén ${formatDiscount(code.type, code.value)} en tu próxima compra.`;
            if (navigator.share) {
                await navigator.share({
                    title: `Código promocional: ${code.name}`,
                    text: shareText,
                });
            }
            else {
                await navigator.clipboard.writeText(shareText);
                mockToast.success('Texto de promoción copiado al portapapeles');
            }
            expect(navigator.clipboard.writeText).toHaveBeenCalledWith('🎫 ¡Descuento especial! Usa el código SUMMER2024 y obtén 20% en tu próxima compra.');
            expect(mockToast.success).toHaveBeenCalledWith('Texto de promoción copiado al portapapeles');
            // Restaurar Web Share API
            navigator.share = originalShare;
        });
    });
    describe('Generación de CSV', () => {
        it('genera CSV con headers correctos', () => {
            const headers = ['Código', 'Nombre', 'Tipo', 'Valor', 'Estado', 'Usado', 'Límite', 'Válido Desde', 'Válido Hasta'];
            const csvHeaders = headers.map(h => `"${h}"`).join(',');
            expect(csvHeaders).toBe('"Código","Nombre","Tipo","Valor","Estado","Usado","Límite","Válido Desde","Válido Hasta"');
        });
        it('genera filas de CSV correctamente', () => {
            var _a;
            const code = mockPromoCodes[0];
            const row = [
                code.code,
                code.name,
                code.type,
                code.value.toString(),
                code.status,
                code.usedCount.toString(),
                ((_a = code.usageLimit) === null || _a === void 0 ? void 0 : _a.toString()) || 'Sin límite',
                code.validFrom,
                code.validUntil || 'Sin fecha límite'
            ];
            const csvRow = row.map(cell => `"${cell}"`).join(',');
            expect(csvRow).toBe('"SUMMER2024","Descuento de Verano","PERCENTAGE","20","ACTIVE","25","100","2024-01-01","2024-12-31"');
        });
        it('maneja códigos sin límite de uso', () => {
            var _a;
            const codeWithoutLimit = Object.assign(Object.assign({}, mockPromoCodes[0]), { usageLimit: undefined, validUntil: undefined });
            const row = [
                codeWithoutLimit.code,
                codeWithoutLimit.name,
                codeWithoutLimit.type,
                codeWithoutLimit.value.toString(),
                codeWithoutLimit.status,
                codeWithoutLimit.usedCount.toString(),
                ((_a = codeWithoutLimit.usageLimit) === null || _a === void 0 ? void 0 : _a.toString()) || 'Sin límite',
                codeWithoutLimit.validFrom,
                codeWithoutLimit.validUntil || 'Sin fecha límite'
            ];
            const csvRow = row.map(cell => `"${cell}"`).join(',');
            expect(csvRow).toBe('"SUMMER2024","Descuento de Verano","PERCENTAGE","20","ACTIVE","25","Sin límite","2024-01-01","Sin fecha límite"');
        });
    });
    describe('Funciones de formato de descuento', () => {
        it('formatea descuentos porcentuales correctamente', () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            expect(formatDiscount('PERCENTAGE', 20)).toBe('20%');
            expect(formatDiscount('PERCENTAGE', 15.5)).toBe('15.5%');
        });
        it('formatea descuentos de monto fijo correctamente', () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            // Los números se formatean según la configuración regional
            // En entorno de test, puede usar punto o coma como separador
            const formatted10k = formatDiscount('FIXED_AMOUNT', 10000);
            const formatted5500 = formatDiscount('FIXED_AMOUNT', 5500);
            // Verificar que contiene el símbolo de moneda y el valor
            expect(formatted10k).toContain('$');
            expect(formatted10k).toContain('10');
            // Aceptar formatos locales con o sin separador de miles
            expect(['$5500', '$5,500', '$5.500']).toContain(formatted5500);
        });
    });
    describe('Simulación de descarga de CSV', () => {
        it('simula la creación de blob y descarga', () => {
            const csvContent = 'header1,header2\nvalue1,value2';
            // Crear blob para el CSV
            new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            // Simular creación de elementos DOM
            const mockLink = {
                setAttribute: jest.fn(),
                click: jest.fn(),
                style: { visibility: 'hidden' },
            };
            // Mock del proceso de descarga
            const createElementSpy = jest.spyOn(document, 'createElement').mockReturnValue(mockLink);
            const appendChildSpy = jest.spyOn(document.body, 'appendChild').mockImplementation();
            const removeChildSpy = jest.spyOn(document.body, 'removeChild').mockImplementation();
            // Simular el proceso de descarga directamente
            const element = document.createElement('a');
            element.setAttribute('href', 'blob:mock-url');
            element.setAttribute('download', 'test.csv');
            element.style.visibility = 'hidden';
            // Simular append, click, remove
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            // Verificar que las funciones del mock funcionan
            expect(mockLink.setAttribute).toBeDefined();
            expect(mockLink.click).toBeDefined();
            // Limpiar mocks
            createElementSpy.mockRestore();
            appendChildSpy.mockRestore();
            removeChildSpy.mockRestore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxfX3Rlc3RzX19cXGhvb2tzXFx1c2VQcm9tb0NvZGVTaGFyaW5nLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFJSCxhQUFhO0FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUhwQixtQ0FBK0I7QUFJL0IsTUFBTSxTQUFTLEdBQUcsY0FBa0MsQ0FBQztBQUVyRCwyQkFBMkI7QUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUU7SUFDdkIsU0FBUyxFQUFFO1FBQ1QsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDakU7SUFDRCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztDQUM3RCxDQUFDLENBQUM7QUFFSCxzQkFBc0I7QUFDdEIsTUFBTSxjQUFjLEdBQUc7SUFDckI7UUFDRSxFQUFFLEVBQUUsR0FBRztRQUNQLElBQUksRUFBRSxZQUFZO1FBQ2xCLElBQUksRUFBRSxxQkFBcUI7UUFDM0IsSUFBSSxFQUFFLFlBQXFCO1FBQzNCLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLFFBQWlCO1FBQ3pCLFNBQVMsRUFBRSxFQUFFO1FBQ2IsVUFBVSxFQUFFLEdBQUc7UUFDZixRQUFRLEVBQUUsS0FBSztRQUNmLFNBQVMsRUFBRSxZQUFZO1FBQ3ZCLFVBQVUsRUFBRSxZQUFZO0tBQ3pCO0lBQ0Q7UUFDRSxFQUFFLEVBQUUsR0FBRztRQUNQLElBQUksRUFBRSxVQUFVO1FBQ2hCLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsSUFBSSxFQUFFLGNBQXVCO1FBQzdCLEtBQUssRUFBRSxLQUFL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O1lBRXBDLGdDQUFnQztZQUNoQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNuQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFbkMsaURBQWlEO1lBQ2pELE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVyQyxnQkFBZ0I7WUFDaEIsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDL0IsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdCLGNBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxfX3Rlc3RzX19cXGhvb2tzXFx1c2VQcm9tb0NvZGVTaGFyaW5nLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRlc3RzIHBhcmEgbGFzIGZ1bmNpb25hbGlkYWRlcyBkZSBjb21wYXJ0aXIgY8OzZGlnb3MgcHJvbW9jaW9uYWxlc1xyXG4gKiBUZXN0cyBzaW1wbGlmaWNhZG9zIHF1ZSBubyBkZXBlbmRlbiBkZSBob29rcyBkZSBSZWFjdFxyXG4gKi9cclxuXHJcbmltcG9ydCB7IHRvYXN0IH0gZnJvbSAnc29ubmVyJztcclxuXHJcbi8vIE1vY2sgdG9hc3RcclxuamVzdC5tb2NrKCdzb25uZXInKTtcclxuY29uc3QgbW9ja1RvYXN0ID0gdG9hc3QgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIHRvYXN0PjtcclxuXHJcbi8vIE1vY2sgbmF2aWdhdG9yIGNsaXBib2FyZFxyXG5PYmplY3QuYXNzaWduKG5hdmlnYXRvciwge1xyXG4gIGNsaXBib2FyZDoge1xyXG4gICAgd3JpdGVUZXh0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSgpKSxcclxuICB9LFxyXG4gIHNoYXJlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSgpKSxcclxufSk7XHJcblxyXG4vLyBNb2NrIFByb21vQ29kZSBkYXRhXHJcbmNvbnN0IG1vY2tQcm9tb0NvZGVzID0gW1xyXG4gIHtcclxuICAgIGlkOiAnMScsXHJcbiAgICBjb2RlOiAnU1VNTUVSMjAyNCcsXHJcbiAgICBuYW1lOiAnRGVzY3VlbnRvIGRlIFZlcmFubycsXHJcbiAgICB0eXBlOiAnUEVSQ0VOVEFHRScgYXMgY29uc3QsXHJcbiAgICB2YWx1ZTogMjAsXHJcbiAgICBzdGF0dXM6ICdBQ1RJVkUnIGFzIGNvbnN0LFxyXG4gICAgdXNlZENvdW50OiAyNSxcclxuICAgIHVzYWdlTGltaXQ6IDEwMCxcclxuICAgIGN1cnJlbmN5OiAnQ0xQJyxcclxuICAgIHZhbGlkRnJvbTogJzIwMjQtMDEtMDEnLFxyXG4gICAgdmFsaWRVbnRpbDogJzIwMjQtMTItMzEnLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICcyJyxcclxuICAgIGNvZGU6ICdGSVhFRDEwSycsXHJcbiAgICBuYW1lOiAnRGVzY3VlbnRvIEZpam8nLFxyXG4gICAgdHlwZTogJ0ZJWEVEX0FNT1VOVCcgYXMgY29uc3QsXHJcbiAgICB2YWx1ZTogMTAwMDAsXHJcbiAgICBzdGF0dXM6ICdJTkFDVElWRScgYXMgY29uc3QsXHJcbiAgICB1c2VkQ291bnQ6IDUwLFxyXG4gICAgdXNhZ2VMaW1pdDogNTAsXHJcbiAgICBjdXJyZW5jeTogJ0NMUCcsXHJcbiAgICB2YWxpZEZyb206ICcyMDI0LTAxLTAxJyxcclxuICAgIHZhbGlkVW50aWw6ICcyMDI0LTA2LTMwJyxcclxuICB9LFxyXG5dO1xyXG5cclxuZGVzY3JpYmUoJ0Z1bmNpb25hbGlkYWRlcyBkZSBDb21wYXJ0aXIgQ8OzZGlnb3MgUHJvbW9jaW9uYWxlcycsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnQ29tcGFydGlyIGNvbiBXZWIgU2hhcmUgQVBJJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbXBhcnRlIGPDs2RpZ28gcHJvbW9jaW9uYWwgY29uIFdlYiBTaGFyZSBBUEkgZGlzcG9uaWJsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZm9ybWF0RGlzY291bnQgPSAodHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSA9PiBcclxuICAgICAgICB0eXBlID09PSAnUEVSQ0VOVEFHRScgPyBgJHt2YWx1ZX0lYCA6IGAkJHt2YWx1ZS50b0xvY2FsZVN0cmluZygpfWA7XHJcblxyXG4gICAgICBjb25zdCBjb2RlID0gbW9ja1Byb21vQ29kZXNbMF07XHJcbiAgICAgIGNvbnN0IHNoYXJlVGV4dCA9IGDwn46rIMKhRGVzY3VlbnRvIGVzcGVjaWFsISBVc2EgZWwgY8OzZGlnbyAke2NvZGUuY29kZX0geSBvYnTDqW4gJHtmb3JtYXREaXNjb3VudChjb2RlLnR5cGUsIGNvZGUudmFsdWUpfSBlbiB0dSBwcsOzeGltYSBjb21wcmEuYDtcclxuXHJcbiAgICAgIGlmIChuYXZpZ2F0b3Iuc2hhcmUpIHtcclxuICAgICAgICBhd2FpdCBuYXZpZ2F0b3Iuc2hhcmUoe1xyXG4gICAgICAgICAgdGl0bGU6IGBDw7NkaWdvIHByb21vY2lvbmFsOiAke2NvZGUubmFtZX1gLFxyXG4gICAgICAgICAgdGV4dDogc2hhcmVUZXh0LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBleHBlY3QobmF2aWdhdG9yLnNoYXJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgdGl0bGU6ICdDw7NkaWdvIHByb21vY2lvbmFsOiBEZXNjdWVudG8gZGUgVmVyYW5vJyxcclxuICAgICAgICB0ZXh0OiAn8J+OqyDCoURlc2N1ZW50byBlc3BlY2lhbCEgVXNhIGVsIGPDs2RpZ28gU1VNTUVSMjAyNCB5IG9idMOpbiAyMCUgZW4gdHUgcHLDs3hpbWEgY29tcHJhLicsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3VzYSBjbGlwYm9hcmQgY29tbyBmYWxsYmFjayBjdWFuZG8gbm8gaGF5IFdlYiBTaGFyZSBBUEknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIFRlbXBvcmFsbWVudGUgZWxpbWluYXIgV2ViIFNoYXJlIEFQSVxyXG4gICAgICBjb25zdCBvcmlnaW5hbFNoYXJlID0gbmF2aWdhdG9yLnNoYXJlO1xyXG4gICAgICBkZWxldGUgKG5hdmlnYXRvciBhcyB1bmtub3duIGFzIHsgc2hhcmU/OiB0eXBlb2YgbmF2aWdhdG9yLnNoYXJlIH0pLnNoYXJlO1xyXG5cclxuICAgICAgY29uc3QgZm9ybWF0RGlzY291bnQgPSAodHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSA9PiBcclxuICAgICAgICB0eXBlID09PSAnUEVSQ0VOVEFHRScgPyBgJHt2YWx1ZX0lYCA6IGAkJHt2YWx1ZS50b0xvY2FsZVN0cmluZygpfWA7XHJcblxyXG4gICAgICBjb25zdCBjb2RlID0gbW9ja1Byb21vQ29kZXNbMF07XHJcbiAgICAgIGNvbnN0IHNoYXJlVGV4dCA9IGDwn46rIMKhRGVzY3VlbnRvIGVzcGVjaWFsISBVc2EgZWwgY8OzZGlnbyAke2NvZGUuY29kZX0geSBvYnTDqW4gJHtmb3JtYXREaXNjb3VudChjb2RlLnR5cGUsIGNvZGUudmFsdWUpfSBlbiB0dSBwcsOzeGltYSBjb21wcmEuYDtcclxuXHJcbiAgICAgIGlmIChuYXZpZ2F0b3Iuc2hhcmUpIHtcclxuICAgICAgICBhd2FpdCBuYXZpZ2F0b3Iuc2hhcmUoe1xyXG4gICAgICAgICAgdGl0bGU6IGBDw7NkaWdvIHByb21vY2lvbmFsOiAke2NvZGUubmFtZX1gLFxyXG4gICAgICAgICAgdGV4dDogc2hhcmVUZXh0LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHNoYXJlVGV4dCk7XHJcbiAgICAgICAgbW9ja1RvYXN0LnN1Y2Nlc3MoJ1RleHRvIGRlIHByb21vY2nDs24gY29waWFkbyBhbCBwb3J0YXBhcGVsZXMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZXhwZWN0KG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAn8J+OqyDCoURlc2N1ZW50byBlc3BlY2lhbCEgVXNhIGVsIGPDs2RpZ28gU1VNTUVSMjAyNCB5IG9idMOpbiAyMCUgZW4gdHUgcHLDs3hpbWEgY29tcHJhLidcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tUb2FzdC5zdWNjZXNzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAnVGV4dG8gZGUgcHJvbW9jacOzbiBjb3BpYWRvIGFsIHBvcnRhcGFwZWxlcydcclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIFJlc3RhdXJhciBXZWIgU2hhcmUgQVBJXHJcbiAgICAgIChuYXZpZ2F0b3IgYXMgdW5rbm93biBhcyB7IHNoYXJlPzogdHlwZW9mIG5hdmlnYXRvci5zaGFyZSB9KS5zaGFyZSA9IG9yaWdpbmFsU2hhcmU7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0dlbmVyYWNpw7NuIGRlIENTVicsICgpID0+IHtcclxuICAgIGl0KCdnZW5lcmEgQ1NWIGNvbiBoZWFkZXJzIGNvcnJlY3RvcycsICgpID0+IHtcclxuICAgICAgY29uc3QgaGVhZGVycyA9IFsnQ8OzZGlnbycsICdOb21icmUnLCAnVGlwbycsICdWYWxvcicsICdFc3RhZG8nLCAnVXNhZG8nLCAnTMOtbWl0ZScsICdWw6FsaWRvIERlc2RlJywgJ1bDoWxpZG8gSGFzdGEnXTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGNzdkhlYWRlcnMgPSBoZWFkZXJzLm1hcChoID0+IGBcIiR7aH1cImApLmpvaW4oJywnKTtcclxuXHJcbiAgICAgIGV4cGVjdChjc3ZIZWFkZXJzKS50b0JlKCdcIkPDs2RpZ29cIixcIk5vbWJyZVwiLFwiVGlwb1wiLFwiVmFsb3JcIixcIkVzdGFkb1wiLFwiVXNhZG9cIixcIkzDrW1pdGVcIixcIlbDoWxpZG8gRGVzZGVcIixcIlbDoWxpZG8gSGFzdGFcIicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2dlbmVyYSBmaWxhcyBkZSBDU1YgY29ycmVjdGFtZW50ZScsICgpID0+IHtcclxuICAgICAgY29uc3QgY29kZSA9IG1vY2tQcm9tb0NvZGVzWzBdO1xyXG4gICAgICBjb25zdCByb3cgPSBbXHJcbiAgICAgICAgY29kZS5jb2RlLFxyXG4gICAgICAgIGNvZGUubmFtZSxcclxuICAgICAgICBjb2RlLnR5cGUsXHJcbiAgICAgICAgY29kZS52YWx1ZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvZGUuc3RhdHVzLFxyXG4gICAgICAgIGNvZGUudXNlZENvdW50LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29kZS51c2FnZUxpbWl0Py50b1N0cmluZygpIHx8ICdTaW4gbMOtbWl0ZScsXHJcbiAgICAgICAgY29kZS52YWxpZEZyb20sXHJcbiAgICAgICAgY29kZS52YWxpZFVudGlsIHx8ICdTaW4gZmVjaGEgbMOtbWl0ZSdcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IGNzdlJvdyA9IHJvdy5tYXAoY2VsbCA9PiBgXCIke2NlbGx9XCJgKS5qb2luKCcsJyk7XHJcblxyXG4gICAgICBleHBlY3QoY3N2Um93KS50b0JlKCdcIlNVTU1FUjIwMjRcIixcIkRlc2N1ZW50byBkZSBWZXJhbm9cIixcIlBFUkNFTlRBR0VcIixcIjIwXCIsXCJBQ1RJVkVcIixcIjI1XCIsXCIxMDBcIixcIjIwMjQtMDEtMDFcIixcIjIwMjQtMTItMzFcIicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ21hbmVqYSBjw7NkaWdvcyBzaW4gbMOtbWl0ZSBkZSB1c28nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvZGVXaXRob3V0TGltaXQgPSB7XHJcbiAgICAgICAgLi4ubW9ja1Byb21vQ29kZXNbMF0sXHJcbiAgICAgICAgdXNhZ2VMaW1pdDogdW5kZWZpbmVkIGFzIG51bWJlciB8IHVuZGVmaW5lZCxcclxuICAgICAgICB2YWxpZFVudGlsOiB1bmRlZmluZWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3Qgcm93ID0gW1xyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQuY29kZSxcclxuICAgICAgICBjb2RlV2l0aG91dExpbWl0Lm5hbWUsXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC50eXBlLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQudmFsdWUudG9TdHJpbmcoKSxcclxuICAgICAgICBjb2RlV2l0aG91dExpbWl0LnN0YXR1cyxcclxuICAgICAgICBjb2RlV2l0aG91dExpbWl0LnVzZWRDb3VudC50b1N0cmluZygpLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQudXNhZ2VMaW1pdD8udG9TdHJpbmcoKSB8fCAnU2luIGzDrW1pdGUnLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQudmFsaWRGcm9tLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQudmFsaWRVbnRpbCB8fCAnU2luIGZlY2hhIGzDrW1pdGUnXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBjb25zdCBjc3ZSb3cgPSByb3cubWFwKGNlbGwgPT4gYFwiJHtjZWxsfVwiYCkuam9pbignLCcpO1xyXG5cclxuICAgICAgZXhwZWN0KGNzdlJvdykudG9CZSgnXCJTVU1NRVIyMDI0XCIsXCJEZXNjdWVudG8gZGUgVmVyYW5vXCIsXCJQRVJDRU5UQUdFXCIsXCIyMFwiLFwiQUNUSVZFXCIsXCIyNVwiLFwiU2luIGzDrW1pdGVcIixcIjIwMjQtMDEtMDFcIixcIlNpbiBmZWNoYSBsw61taXRlXCInKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRnVuY2lvbmVzIGRlIGZvcm1hdG8gZGUgZGVzY3VlbnRvJywgKCkgPT4ge1xyXG4gICAgaXQoJ2Zvcm1hdGVhIGRlc2N1ZW50b3MgcG9yY2VudHVhbGVzIGNvcnJlY3RhbWVudGUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZvcm1hdERpc2NvdW50ID0gKHR5cGU6IHN0cmluZywgdmFsdWU6IG51bWJlcikgPT4gXHJcbiAgICAgICAgdHlwZSA9PT0gJ1BFUkNFTlRBR0UnID8gYCR7dmFsdWV9JWAgOiBgJCR7dmFsdWUudG9Mb2NhbGVTdHJpbmcoKX1gO1xyXG5cclxuICAgICAgZXhwZWN0KGZvcm1hdERpc2NvdW50KCdQRVJDRU5UQUdFJywgMjApKS50b0JlKCcyMCUnKTtcclxuICAgICAgZXhwZWN0KGZvcm1hdERpc2NvdW50KCdQRVJDRU5UQUdFJywgMTUuNSkpLnRvQmUoJzE1LjUlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZm9ybWF0ZWEgZGVzY3VlbnRvcyBkZSBtb250byBmaWpvIGNvcnJlY3RhbWVudGUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZvcm1hdERpc2NvdW50ID0gKHR5cGU6IHN0cmluZywgdmFsdWU6IG51bWJlcikgPT4gXHJcbiAgICAgICAgdHlwZSA9PT0gJ1BFUkNFTlRBR0UnID8gYCR7dmFsdWV9JWAgOiBgJCR7dmFsdWUudG9Mb2NhbGVTdHJpbmcoKX1gO1xyXG5cclxuICAgICAgLy8gTG9zIG7Dum1lcm9zIHNlIGZvcm1hdGVhbiBzZWfDum4gbGEgY29uZmlndXJhY2nDs24gcmVnaW9uYWxcclxuICAgICAgLy8gRW4gZW50b3JubyBkZSB0ZXN0LCBwdWVkZSB1c2FyIHB1bnRvIG8gY29tYSBjb21vIHNlcGFyYWRvclxyXG4gICAgICBjb25zdCBmb3JtYXR0ZWQxMGsgPSBmb3JtYXREaXNjb3VudCgnRklYRURfQU1PVU5UJywgMTAwMDApO1xyXG4gICAgICBjb25zdCBmb3JtYXR0ZWQ1NTAwID0gZm9ybWF0RGlzY291bnQoJ0ZJWEVEX0FNT1VOVCcsIDU1MDApO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBjb250aWVuZSBlbCBzw61tYm9sbyBkZSBtb25lZGEgeSBlbCB2YWxvclxyXG4gICAgICBleHBlY3QoZm9ybWF0dGVkMTBrKS50b0NvbnRhaW4oJyQnKTtcclxuICAgICAgZXhwZWN0KGZvcm1hdHRlZDEwaykudG9Db250YWluKCcxMCcpO1xyXG4gICAgICAvLyBBY2VwdGFyIGZvcm1hdG9zIGxvY2FsZXMgY29uIG8gc2luIHNlcGFyYWRvciBkZSBtaWxlc1xyXG4gICAgICBleHBlY3QoWyckNTUwMCcsICckNSw1MDAnLCAnJDUuNTAwJ10pLnRvQ29udGFpbihmb3JtYXR0ZWQ1NTAwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnU2ltdWxhY2nDs24gZGUgZGVzY2FyZ2EgZGUgQ1NWJywgKCkgPT4ge1xyXG4gICAgaXQoJ3NpbXVsYSBsYSBjcmVhY2nDs24gZGUgYmxvYiB5IGRlc2NhcmdhJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gJ2hlYWRlcjEsaGVhZGVyMlxcbnZhbHVlMSx2YWx1ZTInO1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXIgYmxvYiBwYXJhIGVsIENTVlxyXG4gICAgICBuZXcgQmxvYihbY3N2Q29udGVudF0sIHsgdHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7JyB9KTtcclxuXHJcbiAgICAgIC8vIFNpbXVsYXIgY3JlYWNpw7NuIGRlIGVsZW1lbnRvcyBET01cclxuICAgICAgY29uc3QgbW9ja0xpbmsgPSB7XHJcbiAgICAgICAgc2V0QXR0cmlidXRlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgY2xpY2s6IGplc3QuZm4oKSxcclxuICAgICAgICBzdHlsZTogeyB2aXNpYmlsaXR5OiAnaGlkZGVuJyB9LFxyXG4gICAgICB9IGFzIHVua25vd24gYXMgSFRNTEFuY2hvckVsZW1lbnQ7XHJcblxyXG4gICAgICAvLyBNb2NrIGRlbCBwcm9jZXNvIGRlIGRlc2NhcmdhXHJcbiAgICAgIGNvbnN0IGNyZWF0ZUVsZW1lbnRTcHkgPSBqZXN0LnNweU9uKGRvY3VtZW50LCAnY3JlYXRlRWxlbWVudCcpLm1vY2tSZXR1cm5WYWx1ZShtb2NrTGluayk7XHJcbiAgICAgIGNvbnN0IGFwcGVuZENoaWxkU3B5ID0gamVzdC5zcHlPbihkb2N1bWVudC5ib2R5LCAnYXBwZW5kQ2hpbGQnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcclxuICAgICAgY29uc3QgcmVtb3ZlQ2hpbGRTcHkgPSBqZXN0LnNweU9uKGRvY3VtZW50LmJvZHksICdyZW1vdmVDaGlsZCcpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG5cclxuICAgICAgLy8gU2ltdWxhciBlbCBwcm9jZXNvIGRlIGRlc2NhcmdhIGRpcmVjdGFtZW50ZVxyXG4gICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsICdibG9iOm1vY2stdXJsJyk7XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsICd0ZXN0LmNzdicpO1xyXG4gICAgICBlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgXHJcbiAgICAgIC8vIFNpbXVsYXIgYXBwZW5kLCBjbGljaywgcmVtb3ZlXHJcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgIGVsZW1lbnQuY2xpY2soKTtcclxuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtZW50KTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhciBxdWUgbGFzIGZ1bmNpb25lcyBkZWwgbW9jayBmdW5jaW9uYW5cclxuICAgICAgZXhwZWN0KG1vY2tMaW5rLnNldEF0dHJpYnV0ZSkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KG1vY2tMaW5rLmNsaWNrKS50b0JlRGVmaW5lZCgpO1xyXG5cclxuICAgICAgLy8gTGltcGlhciBtb2Nrc1xyXG4gICAgICBjcmVhdGVFbGVtZW50U3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgIGFwcGVuZENoaWxkU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgIHJlbW92ZUNoaWxkU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==