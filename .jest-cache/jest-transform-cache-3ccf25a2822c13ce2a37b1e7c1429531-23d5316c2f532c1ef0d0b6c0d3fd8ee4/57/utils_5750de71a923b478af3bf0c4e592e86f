7009d03a3e2de08b9efeda0eb44854f8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cn = cn;
exports.formatCurrency = formatCurrency;
exports.formatPriceRange = formatPriceRange;
exports.formatNumber = formatNumber;
exports.formatPercentage = formatPercentage;
exports.formatDisplayDate = formatDisplayDate;
exports.formatDisplayDateTime = formatDisplayDateTime;
exports.formatTime = formatTime;
exports.formatShortDate = formatShortDate;
exports.getRelativeDateDescription = getRelativeDateDescription;
exports.isFutureDate = isFutureDate;
exports.isValidEmail = isValidEmail;
exports.isValidUrl = isValidUrl;
exports.capitalize = capitalize;
exports.slugify = slugify;
exports.truncate = truncate;
exports.getInitials = getInitials;
exports.formatFullName = formatFullName;
exports.groupBy = groupBy;
exports.sortBy = sortBy;
exports.unique = unique;
exports.formatDiscount = formatDiscount;
exports.calculateUsagePercentage = calculateUsagePercentage;
exports.getStatusConfig = getStatusConfig;
exports.debounce = debounce;
exports.formatFileSize = formatFileSize;
exports.isValidImageFile = isValidImageFile;
const clsx_1 = require("clsx");
const tailwind_merge_1 = require("tailwind-merge");
function cn(...inputs) {
    return (0, tailwind_merge_1.twMerge)((0, clsx_1.clsx)(inputs));
}
function formatCurrency(amount, currency = 'CLP') {
    if (amount === 0)
        return 'Gratis';
    return new Intl.NumberFormat('es-CL', {
        style: 'currency',
        currency: currency,
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}
function formatPriceRange(min, max, currency = 'CLP') {
    if (min === 0 && max === 0)
        return "Gratis";
    if (min === max)
        return formatCurrency(min, currency);
    return `Desde ${formatCurrency(min, currency)}`;
}
function formatNumber(num) {
    if (num >= 1000000000) {
        return (num / 1000000000).toFixed(1) + 'B';
    }
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    }
    if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}
function formatPercentage(value, decimals = 1) {
    return `${value.toFixed(decimals)}%`;
}
function formatDisplayDate(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleDateString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        timeZone: "America/Santiago",
    });
}
function formatDisplayDateTime(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleString("es-CL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
}
function formatTime(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleTimeString("es-CL", {
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "America/Santiago",
    });
}
function formatShortDate(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj.toLocaleDateString("es-CL", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        timeZone: "America/Santiago",
    });
}
function getRelativeDateDescription(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    const now = new Date();
    if (dateObj.toDateString() === now.toDateString())
        return "Hoy";
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    if (dateObj.toDateString() === tomorrow.toDateString())
        return "Mañana";
    const diffTime = dateObj.getTime() - now.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    if (diffDays < 0) {
        return diffDays === -1 ? "Ayer" : `Hace ${Math.abs(diffDays)} días`;
    }
    else if (diffDays <= 7) {
        return `En ${diffDays} días`;
    }
    else {
        return formatDisplayDate(dateObj);
    }
}
function isFutureDate(date) {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return dateObj > new Date();
}
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}
function isValidUrl(url) {
    try {
        new URL(url);
        return true;
    }
    catch (_a) {
        return false;
    }
}
function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}
function slugify(text) {
    return text
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();
}
function truncate(text, length) {
    if (text.length <= length)
        return text;
    return text.slice(0, length) + '...';
}
function getInitials(firstName, lastName) {
    const first = (firstName === null || firstName === void 0 ? void 0 : firstName.charAt(0).toUpperCase()) || '';
    const last = (lastName === null || lastName === void 0 ? void 0 : lastName.charAt(0).toUpperCase()) || '';
    return (first + last) || '?';
}
function formatFullName(firstName, lastName) {
    const parts = [firstName, lastName].filter(Boolean);
    return parts.length > 0 ? parts.join(' ') : 'Usuario';
}
function groupBy(array, key) {
    return array.reduce((groups, item) => {
        const group = String(item[key]);
        return Object.assign(Object.assign({}, groups), { [group]: [...(groups[group] || []), item] });
    }, {});
}
function sortBy(array, key, direction = 'asc') {
    return [...array].sort((a, b) => {
        const aValue = a[key];
        const bValue = b[key];
        if (aValue < bValue)
            return direction === 'asc' ? -1 : 1;
        if (aValue > bValue)
            return direction === 'asc' ? 1 : -1;
        return 0;
    });
}
function unique(array) {
    return [...new Set(array)];
}
function formatDiscount(type, value) {
    switch (type) {
        case "PERCENTAGE":
            return `${value}%`;
        case "FIXED_AMOUNT":
            return formatCurrency(value);
        case "FREE":
            return "Gratis";
        default:
            return value.toString();
    }
}
function calculateUsagePercentage(used, limit) {
    if (!limit)
        return 0;
    return Math.min((used / limit) * 100, 100);
}
function getStatusConfig(status) {
    const configs = {
        ACTIVE: { label: "Activo", color: "bg-green-100 text-green-800", variant: "default" },
        INACTIVE: { label: "Inactivo", color: "bg-gray-100 text-gray-800", variant: "secondary" },
        EXPIRED: { label: "Expirado", color: "bg-red-100 text-red-800", variant: "destructive" },
        USED_UP: { label: "Agotado", color: "bg-orange-100 text-orange-800", variant: "outline" },
        PENDING: { label: "Pendiente", color: "bg-yellow-100 text-yellow-800", variant: "outline" },
        PAID: { label: "Pagado", color: "bg-green-100 text-green-800", variant: "default" },
        FAILED: { label: "Fallido", color: "bg-red-100 text-red-800", variant: "destructive" },
        CANCELLED: { label: "Cancelado", color: "bg-gray-100 text-gray-800", variant: "secondary" },
        REFUNDED: { label: "Reembolsado", color: "bg-blue-100 text-blue-800", variant: "outline" },
    };
    return configs[status] || {
        label: status,
        color: "bg-gray-100 text-gray-800",
        variant: "secondary"
    };
}
function debounce(func, wait) {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
    };
}
function formatFileSize(bytes) {
    if (bytes === 0)
        return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
function isValidImageFile(filename) {
    const validExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];
    const extension = filename.toLowerCase().substring(filename.lastIndexOf('.'));
    return validExtensions.includes(extension);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxsaWJcXHV0aWxzLnRzIiwibWFwcGluZ3MiOiI7O0FBU0EsZ0JBRUM7QUFPRCx3Q0FZQztBQUdELDRDQVFDO0FBR0Qsb0NBV0M7QUFHRCw0Q0FFQztBQU9ELDhDQVVDO0FBR0Qsc0RBWUM7QUFHRCxnQ0FRQztBQUdELDBDQVNDO0FBR0QsZ0VBdUJDO0FBT0Qsb0NBR0M7QUFHRCxvQ0FHQztBQUdELGdDQU9DO0FBT0QsZ0NBRUM7QUFHRCwwQkFTQztBQUdELDRCQUdDO0FBR0Qsa0NBSUM7QUFHRCx3Q0FHQztBQU9ELDBCQVFDO0FBR0Qsd0JBU0M7QUFHRCx3QkFFQztBQU9ELHdDQVdDO0FBR0QsNERBR0M7QUFPRCwwQ0FzQkM7QUFPRCw0QkFVQztBQU9ELHdDQVFDO0FBR0QsNENBSUM7QUF6VUQsK0JBQTZDO0FBQzdDLG1EQUF5QztBQU16QyxTQUFnQixFQUFFLENBQUMsR0FBRyxNQUFvQjtJQUN4QyxPQUFPLElBQUEsd0JBQU8sRUFBQyxJQUFBLFdBQUksRUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQy9CLENBQUM7QUFPRCxTQUFnQixjQUFjLENBQzVCLE1BQWMsRUFDZCxXQUFtQixLQUFLO0lBRXhCLElBQUksTUFBTSxLQUFLLENBQUM7UUFBRSxPQUFPLFFBQVEsQ0FBQztJQUVsQyxPQUFPLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUU7UUFDcEMsS0FBSyxFQUFFLFVBQVU7UUFDakIsUUFBUSxFQUFFLFFBQVE7UUFDbEIscUJBQXFCLEVBQUUsQ0FBQztRQUN4QixxQkFBcUIsRUFBRSxDQUFDO0tBQ3pCLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDcEIsQ0FBQztBQUdELFNBQWdCLGdCQUFnQixDQUM5QixHQUFXLEVBQ1gsR0FBVyxFQUNYLFdBQW1CLEtBQUs7SUFFeEIsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLEdB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SUFFcEQsT0FBTyxVQUFVLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFFLENBQUM7QUFHRCxTQUFnQixnQkFBZ0IsQ0FBQyxRQUFnQjtJQUMvQyxNQUFNLGVBQWUsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRSxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM5RSxPQUFPLGVBQWUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDN0MsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJpbHVyXFxEb2N1bWVudHNcXERldmVsb3BtZW50XFxOZXh0XFxzb3J5Y2stYWNjZXNzXFxzcmNcXGxpYlxcdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcblxyXG5pbXBvcnQgeyB0eXBlIENsYXNzVmFsdWUsIGNsc3ggfSBmcm9tIFwiY2xzeFwiO1xyXG5pbXBvcnQgeyB0d01lcmdlIH0gZnJvbSBcInRhaWx3aW5kLW1lcmdlXCI7XHJcblxyXG5cblxuXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNuKC4uLmlucHV0czogQ2xhc3NWYWx1ZVtdKSB7XHJcbiAgcmV0dXJuIHR3TWVyZ2UoY2xzeChpbnB1dHMpKTtcclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0Q3VycmVuY3koXHJcbiAgYW1vdW50OiBudW1iZXIsIFxyXG4gIGN1cnJlbmN5OiBzdHJpbmcgPSAnQ0xQJ1xyXG4pOiBzdHJpbmcge1xyXG4gIGlmIChhbW91bnQgPT09IDApIHJldHVybiAnR3JhdGlzJztcclxuICBcclxuICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdlcy1DTCcsIHtcclxuICAgIHN0eWxlOiAnY3VycmVuY3knLFxyXG4gICAgY3VycmVuY3k6IGN1cnJlbmN5LFxyXG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAwLFxyXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwXHJcbiAgfSkuZm9ybWF0KGFtb3VudCk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0UHJpY2VSYW5nZShcclxuICBtaW46IG51bWJlciwgXHJcbiAgbWF4OiBudW1iZXIsIFxyXG4gIGN1cnJlbmN5OiBzdHJpbmcgPSAnQ0xQJ1xyXG4pOiBzdHJpbmcge1xyXG4gIGlmIChtaW4gPT09IDAgJiYgbWF4ID09PSAwKSByZXR1cm4gXCJHcmF0aXNcIjtcclxuICBpZiAobWluID09PSBtYXgpIHJldHVybiBmb3JtYXRDdXJyZW5jeShtaW4sIGN1cnJlbmN5KTtcclxuICByZXR1cm4gYERlc2RlICR7Zm9ybWF0Q3VycmVuY3kobWluLCBjdXJyZW5jeSl9YDtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtOiBudW1iZXIpOiBzdHJpbmcge1xyXG4gIGlmIChudW0gPj0gMTAwMDAwMDAwMCkge1xyXG4gICAgcmV0dXJuIChudW0gLyAxMDAwMDAwMDAwKS50b0ZpeGVkKDEpICsgJ0InO1xyXG4gIH1cclxuICBpZiAobnVtID49IDEwMDAwMDApIHtcclxuICAgIHJldHVybiAobnVtIC8gMTAwMDAwMCkudG9GaXhlZCgxKSArICdNJztcclxuICB9XHJcbiAgaWYgKG51bSA+PSAxMDAwKSB7XHJcbiAgICByZXR1cm4gKG51bSAvIDEwMDApLnRvRml4ZWQoMSkgKyAnSyc7XHJcbiAgfVxyXG4gIHJldHVybiBudW0udG9TdHJpbmcoKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRQZXJjZW50YWdlKHZhbHVlOiBudW1iZXIsIGRlY2ltYWxzOiBudW1iZXIgPSAxKTogc3RyaW5nIHtcclxuICByZXR1cm4gYCR7dmFsdWUudG9GaXhlZChkZWNpbWFscyl9JWA7XHJcbn1cclxuXHJcblxuXG5cblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERpc3BsYXlEYXRlKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGRhdGVPYmogPSB0eXBlb2YgZGF0ZSA9PT0gJ3N0cmluZycgPyBuZXcgRGF0ZShkYXRlKSA6IGRhdGU7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGVPYmoudG9Mb2NhbGVEYXRlU3RyaW5nKFwiZXMtQ0xcIiwge1xyXG4gICAgd2Vla2RheTogXCJsb25nXCIsXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIG1vbnRoOiBcImxvbmdcIixcclxuICAgIGRheTogXCJudW1lcmljXCIsXHJcbiAgICB0aW1lWm9uZTogXCJBbWVyaWNhL1NhbnRpYWdvXCIsXHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGlzcGxheURhdGVUaW1lKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGRhdGVPYmogPSB0eXBlb2YgZGF0ZSA9PT0gJ3N0cmluZycgPyBuZXcgRGF0ZShkYXRlKSA6IGRhdGU7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGVPYmoudG9Mb2NhbGVTdHJpbmcoXCJlcy1DTFwiLCB7XHJcbiAgICB3ZWVrZGF5OiBcImxvbmdcIixcclxuICAgIHllYXI6IFwibnVtZXJpY1wiLFxyXG4gICAgbW9udGg6IFwibG9uZ1wiLFxyXG4gICAgZGF5OiBcIm51bWVyaWNcIixcclxuICAgIGhvdXI6IFwiMi1kaWdpdFwiLFxyXG4gICAgbWludXRlOiBcIjItZGlnaXRcIixcclxuICAgIHRpbWVab25lOiBcIkFtZXJpY2EvU2FudGlhZ29cIixcclxuICB9KTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRUaW1lKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGRhdGVPYmogPSB0eXBlb2YgZGF0ZSA9PT0gJ3N0cmluZycgPyBuZXcgRGF0ZShkYXRlKSA6IGRhdGU7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGVPYmoudG9Mb2NhbGVUaW1lU3RyaW5nKFwiZXMtQ0xcIiwge1xyXG4gICAgaG91cjogXCIyLWRpZ2l0XCIsXHJcbiAgICBtaW51dGU6IFwiMi1kaWdpdFwiLFxyXG4gICAgdGltZVpvbmU6IFwiQW1lcmljYS9TYW50aWFnb1wiLFxyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFNob3J0RGF0ZShkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlT2JqLnRvTG9jYWxlRGF0ZVN0cmluZyhcImVzLUNMXCIsIHtcclxuICAgIGRheTogXCIyLWRpZ2l0XCIsXHJcbiAgICBtb250aDogXCIyLWRpZ2l0XCIsXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIHRpbWVab25lOiBcIkFtZXJpY2EvU2FudGlhZ29cIixcclxuICB9KTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWxhdGl2ZURhdGVEZXNjcmlwdGlvbihkYXRlOiBEYXRlIHwgc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgXHJcbiAgXG4gIGlmIChkYXRlT2JqLnRvRGF0ZVN0cmluZygpID09PSBub3cudG9EYXRlU3RyaW5nKCkpIHJldHVybiBcIkhveVwiO1xyXG4gIFxyXG4gIFxuICBjb25zdCB0b21vcnJvdyA9IG5ldyBEYXRlKG5vdyk7XHJcbiAgdG9tb3Jyb3cuc2V0RGF0ZSh0b21vcnJvdy5nZXREYXRlKCkgKyAxKTtcclxuICBpZiAoZGF0ZU9iai50b0RhdGVTdHJpbmcoKSA9PT0gdG9tb3Jyb3cudG9EYXRlU3RyaW5nKCkpIHJldHVybiBcIk1hw7FhbmFcIjtcclxuICBcclxuICBcbiAgY29uc3QgZGlmZlRpbWUgPSBkYXRlT2JqLmdldFRpbWUoKSAtIG5vdy5nZXRUaW1lKCk7XHJcbiAgY29uc3QgZGlmZkRheXMgPSBNYXRoLmNlaWwoZGlmZlRpbWUgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xyXG4gIFxyXG4gIGlmIChkaWZmRGF5cyA8IDApIHtcclxuICAgIHJldHVybiBkaWZmRGF5cyA9PT0gLTEgPyBcIkF5ZXJcIiA6IGBIYWNlICR7TWF0aC5hYnMoZGlmZkRheXMpfSBkw61hc2A7XHJcbiAgfSBlbHNlIGlmIChkaWZmRGF5cyA8PSA3KSB7XHJcbiAgICByZXR1cm4gYEVuICR7ZGlmZkRheXN9IGTDrWFzYDtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGZvcm1hdERpc3BsYXlEYXRlKGRhdGVPYmopO1xyXG4gIH1cclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNGdXR1cmVEYXRlKGRhdGU6IERhdGUgfCBzdHJpbmcpOiBib29sZWFuIHtcclxuICBjb25zdCBkYXRlT2JqID0gdHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUoZGF0ZSkgOiBkYXRlO1xyXG4gIHJldHVybiBkYXRlT2JqID4gbmV3IERhdGUoKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkRW1haWwoZW1haWw6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuICByZXR1cm4gZW1haWxSZWdleC50ZXN0KGVtYWlsKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkVXJsKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgdHJ5IHtcclxuICAgIG5ldyBVUkwodXJsKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0gY2F0Y2gge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNsdWdpZnkodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcclxuICByZXR1cm4gdGV4dFxyXG4gICAgLnRvTG93ZXJDYXNlKClcclxuICAgIC5ub3JtYWxpemUoJ05GRCcpXHJcbiAgICAucmVwbGFjZSgvW1xcdTAzMDAtXFx1MDM2Zl0vZywgJycpIFxuICAgIC5yZXBsYWNlKC9bXmEtejAtOVxccy1dL2csICcnKSBcbiAgICAucmVwbGFjZSgvXFxzKy9nLCAnLScpIFxuICAgIC5yZXBsYWNlKC8tKy9nLCAnLScpIFxuICAgIC50cmltKCk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdHJ1bmNhdGUodGV4dDogc3RyaW5nLCBsZW5ndGg6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgaWYgKHRleHQubGVuZ3RoIDw9IGxlbmd0aCkgcmV0dXJuIHRleHQ7XHJcbiAgcmV0dXJuIHRleHQuc2xpY2UoMCwgbGVuZ3RoKSArICcuLi4nO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEluaXRpYWxzKGZpcnN0TmFtZT86IHN0cmluZyB8IG51bGwsIGxhc3ROYW1lPzogc3RyaW5nIHwgbnVsbCk6IHN0cmluZyB7XHJcbiAgY29uc3QgZmlyc3QgPSBmaXJzdE5hbWU/LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpIHx8ICcnO1xyXG4gIGNvbnN0IGxhc3QgPSBsYXN0TmFtZT8uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgfHwgJyc7XHJcbiAgcmV0dXJuIChmaXJzdCArIGxhc3QpIHx8ICc/JztcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRGdWxsTmFtZShmaXJzdE5hbWU/OiBzdHJpbmcgfCBudWxsLCBsYXN0TmFtZT86IHN0cmluZyB8IG51bGwpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHBhcnRzID0gW2ZpcnN0TmFtZSwgbGFzdE5hbWVdLmZpbHRlcihCb29sZWFuKTtcclxuICByZXR1cm4gcGFydHMubGVuZ3RoID4gMCA/IHBhcnRzLmpvaW4oJyAnKSA6ICdVc3VhcmlvJztcclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ3JvdXBCeTxULCBLIGV4dGVuZHMga2V5b2YgVD4oYXJyYXk6IFRbXSwga2V5OiBLKTogUmVjb3JkPHN0cmluZywgVFtdPiB7XHJcbiAgcmV0dXJuIGFycmF5LnJlZHVjZSgoZ3JvdXBzLCBpdGVtKSA9PiB7XHJcbiAgICBjb25zdCBncm91cCA9IFN0cmluZyhpdGVtW2tleV0pO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLi4uZ3JvdXBzLFxyXG4gICAgICBbZ3JvdXBdOiBbLi4uKGdyb3Vwc1tncm91cF0gfHwgW10pLCBpdGVtXVxyXG4gICAgfTtcclxuICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBUW10+KTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzb3J0Qnk8VD4oYXJyYXk6IFRbXSwga2V5OiBrZXlvZiBULCBkaXJlY3Rpb246ICdhc2MnIHwgJ2Rlc2MnID0gJ2FzYycpOiBUW10ge1xyXG4gIHJldHVybiBbLi4uYXJyYXldLnNvcnQoKGEsIGIpID0+IHtcclxuICAgIGNvbnN0IGFWYWx1ZSA9IGFba2V5XTtcclxuICAgIGNvbnN0IGJWYWx1ZSA9IGJba2V5XTtcclxuICAgIFxyXG4gICAgaWYgKGFWYWx1ZSA8IGJWYWx1ZSkgcmV0dXJuIGRpcmVjdGlvbiA9PT0gJ2FzYycgPyAtMSA6IDE7XHJcbiAgICBpZiAoYVZhbHVlID4gYlZhbHVlKSByZXR1cm4gZGlyZWN0aW9uID09PSAnYXNjJyA/IDEgOiAtMTtcclxuICAgIHJldHVybiAwO1xyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVuaXF1ZTxUPihhcnJheTogVFtdKTogVFtdIHtcclxuICByZXR1cm4gWy4uLm5ldyBTZXQoYXJyYXkpXTtcclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGlzY291bnQodHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogc3RyaW5nIHtcclxuICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgIGNhc2UgXCJQRVJDRU5UQUdFXCI6XHJcbiAgICAgIHJldHVybiBgJHt2YWx1ZX0lYDtcclxuICAgIGNhc2UgXCJGSVhFRF9BTU9VTlRcIjpcclxuICAgICAgcmV0dXJuIGZvcm1hdEN1cnJlbmN5KHZhbHVlKTtcclxuICAgIGNhc2UgXCJGUkVFXCI6XHJcbiAgICAgIHJldHVybiBcIkdyYXRpc1wiO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVVzYWdlUGVyY2VudGFnZSh1c2VkOiBudW1iZXIsIGxpbWl0PzogbnVtYmVyKTogbnVtYmVyIHtcclxuICBpZiAoIWxpbWl0KSByZXR1cm4gMDtcclxuICByZXR1cm4gTWF0aC5taW4oKHVzZWQgLyBsaW1pdCkgKiAxMDAsIDEwMCk7XHJcbn1cclxuXHJcblxuXG5cblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFN0YXR1c0NvbmZpZyhzdGF0dXM6IHN0cmluZyk6IHtcclxuICBsYWJlbDogc3RyaW5nO1xyXG4gIGNvbG9yOiBzdHJpbmc7XHJcbiAgdmFyaWFudDogXCJkZWZhdWx0XCIgfCBcInNlY29uZGFyeVwiIHwgXCJkZXN0cnVjdGl2ZVwiIHwgXCJvdXRsaW5lXCI7XHJcbn0ge1xyXG4gIGNvbnN0IGNvbmZpZ3MgPSB7XHJcbiAgICBBQ1RJVkU6IHsgbGFiZWw6IFwiQWN0aXZvXCIsIGNvbG9yOiBcImJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTgwMFwiLCB2YXJpYW50OiBcImRlZmF1bHRcIiBhcyBjb25zdCB9LFxyXG4gICAgSU5BQ1RJVkU6IHsgbGFiZWw6IFwiSW5hY3Rpdm9cIiwgY29sb3I6IFwiYmctZ3JheS0xMDAgdGV4dC1ncmF5LTgwMFwiLCB2YXJpYW50OiBcInNlY29uZGFyeVwiIGFzIGNvbnN0IH0sXHJcbiAgICBFWFBJUkVEOiB7IGxhYmVsOiBcIkV4cGlyYWRvXCIsIGNvbG9yOiBcImJnLXJlZC0xMDAgdGV4dC1yZWQtODAwXCIsIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiBhcyBjb25zdCB9LFxyXG4gICAgVVNFRF9VUDogeyBsYWJlbDogXCJBZ290YWRvXCIsIGNvbG9yOiBcImJnLW9yYW5nZS0xMDAgdGV4dC1vcmFuZ2UtODAwXCIsIHZhcmlhbnQ6IFwib3V0bGluZVwiIGFzIGNvbnN0IH0sXHJcbiAgICBQRU5ESU5HOiB7IGxhYmVsOiBcIlBlbmRpZW50ZVwiLCBjb2xvcjogXCJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMFwiLCB2YXJpYW50OiBcIm91dGxpbmVcIiBhcyBjb25zdCB9LFxyXG4gICAgUEFJRDogeyBsYWJlbDogXCJQYWdhZG9cIiwgY29sb3I6IFwiYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwXCIsIHZhcmlhbnQ6IFwiZGVmYXVsdFwiIGFzIGNvbnN0IH0sXHJcbiAgICBGQUlMRUQ6IHsgbGFiZWw6IFwiRmFsbGlkb1wiLCBjb2xvcjogXCJiZy1yZWQtMTAwIHRleHQtcmVkLTgwMFwiLCB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIgYXMgY29uc3QgfSxcclxuICAgIENBTkNFTExFRDogeyBsYWJlbDogXCJDYW5jZWxhZG9cIiwgY29sb3I6IFwiYmctZ3JheS0xMDAgdGV4dC1ncmF5LTgwMFwiLCB2YXJpYW50OiBcInNlY29uZGFyeVwiIGFzIGNvbnN0IH0sXHJcbiAgICBSRUZVTkRFRDogeyBsYWJlbDogXCJSZWVtYm9sc2Fkb1wiLCBjb2xvcjogXCJiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwXCIsIHZhcmlhbnQ6IFwib3V0bGluZVwiIGFzIGNvbnN0IH0sXHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIGNvbmZpZ3Nbc3RhdHVzIGFzIGtleW9mIHR5cGVvZiBjb25maWdzXSB8fCB7XHJcbiAgICBsYWJlbDogc3RhdHVzLFxyXG4gICAgY29sb3I6IFwiYmctZ3JheS0xMDAgdGV4dC1ncmF5LTgwMFwiLFxyXG4gICAgdmFyaWFudDogXCJzZWNvbmRhcnlcIiBhcyBjb25zdFxyXG4gIH07XHJcbn1cclxuXHJcblxuXG5cblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlYm91bmNlPFQgZXh0ZW5kcyAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duPihcclxuICBmdW5jOiBULFxyXG4gIHdhaXQ6IG51bWJlclxyXG4pOiAoLi4uYXJnczogUGFyYW1ldGVyczxUPikgPT4gdm9pZCB7XHJcbiAgbGV0IHRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0O1xyXG4gIFxyXG4gIHJldHVybiAoLi4uYXJnczogUGFyYW1ldGVyczxUPikgPT4ge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gZnVuYyguLi5hcmdzKSwgd2FpdCk7XHJcbiAgfTtcclxufVxyXG5cclxuXG5cblxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgaWYgKGJ5dGVzID09PSAwKSByZXR1cm4gJzAgQnl0ZXMnO1xyXG4gIFxyXG4gIGNvbnN0IGsgPSAxMDI0O1xyXG4gIGNvbnN0IHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQiddO1xyXG4gIGNvbnN0IGkgPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKGspKTtcclxuICBcclxuICByZXR1cm4gcGFyc2VGbG9hdCgoYnl0ZXMgLyBNYXRoLnBvdyhrLCBpKSkudG9GaXhlZCgyKSkgKyAnICcgKyBzaXplc1tpXTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkSW1hZ2VGaWxlKGZpbGVuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICBjb25zdCB2YWxpZEV4dGVuc2lvbnMgPSBbJy5qcGcnLCAnLmpwZWcnLCAnLnBuZycsICcuZ2lmJywgJy53ZWJwJ107XHJcbiAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZW5hbWUudG9Mb3dlckNhc2UoKS5zdWJzdHJpbmcoZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKSk7XHJcbiAgcmV0dXJuIHZhbGlkRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pO1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==