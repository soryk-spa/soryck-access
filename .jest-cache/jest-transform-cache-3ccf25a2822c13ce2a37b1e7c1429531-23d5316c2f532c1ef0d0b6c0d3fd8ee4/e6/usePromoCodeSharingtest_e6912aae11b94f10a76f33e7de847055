a50d5fbb4baf7b0a916934c1f003ec9e
"use strict";
/**
 * Tests para las funcionalidades de compartir códigos promocionales
 * Tests simplificados que no dependen de hooks de React
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock toast
jest.mock('sonner');
const sonner_1 = require("sonner");
const mockToast = sonner_1.toast;
// Mock navigator clipboard
Object.assign(navigator, {
    clipboard: {
        writeText: jest.fn().mockImplementation(() => Promise.resolve()),
    },
    share: jest.fn().mockImplementation(() => Promise.resolve()),
});
// Mock PromoCode data
const mockPromoCodes = [
    {
        id: '1',
        code: 'SUMMER2024',
        name: 'Descuento de Verano',
        type: 'PERCENTAGE',
        value: 20,
        status: 'ACTIVE',
        usedCount: 25,
        usageLimit: 100,
        currency: 'CLP',
        validFrom: '2024-01-01',
        validUntil: '2024-12-31',
    },
    {
        id: '2',
        code: 'FIXED10K',
        name: 'Descuento Fijo',
        type: 'FIXED_AMOUNT',
        value: 10000,
        status: 'INACTIVE',
        usedCount: 50,
        usageLimit: 50,
        currency: 'CLP',
        validFrom: '2024-01-01',
        validUntil: '2024-06-30',
    },
];
describe('Funcionalidades de Compartir Códigos Promocionales', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('Compartir con Web Share API', () => {
        it('comparte código promocional con Web Share API disponible', async () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            const code = mockPromoCodes[0];
            const shareText = `🎫 ¡Descuento especial! Usa el código ${code.code} y obtén ${formatDiscount(code.type, code.value)} en tu próxima compra.`;
            if (navigator.share) {
                await navigator.share({
                    title: `Código promocional: ${code.name}`,
                    text: shareText,
                });
            }
            expect(navigator.share).toHaveBeenCalledWith({
                title: 'Código promocional: Descuento de Verano',
                text: '🎫 ¡Descuento especial! Usa el código SUMMER2024 y obtén 20% en tu próxima compra.',
            });
        });
        it('usa clipboard como fallback cuando no hay Web Share API', async () => {
            // Temporalmente eliminar Web Share API
            const originalShare = navigator.share;
            delete navigator.share;
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            const code = mockPromoCodes[0];
            const shareText = `🎫 ¡Descuento especial! Usa el código ${code.code} y obtén ${formatDiscount(code.type, code.value)} en tu próxima compra.`;
            if (navigator.share) {
                await navigator.share({
                    title: `Código promocional: ${code.name}`,
                    text: shareText,
                });
            }
            else {
                await navigator.clipboard.writeText(shareText);
                mockToast.success('Texto de promoción copiado al portapapeles');
            }
            expect(navigator.clipboard.writeText).toHaveBeenCalledWith('🎫 ¡Descuento especial! Usa el código SUMMER2024 y obtén 20% en tu próxima compra.');
            expect(mockToast.success).toHaveBeenCalledWith('Texto de promoción copiado al portapapeles');
            // Restaurar Web Share API
            navigator.share = originalShare;
        });
    });
    describe('Generación de CSV', () => {
        it('genera CSV con headers correctos', () => {
            const headers = ['Código', 'Nombre', 'Tipo', 'Valor', 'Estado', 'Usado', 'Límite', 'Válido Desde', 'Válido Hasta'];
            const csvHeaders = headers.map(h => `"${h}"`).join(',');
            expect(csvHeaders).toBe('"Código","Nombre","Tipo","Valor","Estado","Usado","Límite","Válido Desde","Válido Hasta"');
        });
        it('genera filas de CSV correctamente', () => {
            var _a;
            const code = mockPromoCodes[0];
            const row = [
                code.code,
                code.name,
                code.type,
                code.value.toString(),
                code.status,
                code.usedCount.toString(),
                ((_a = code.usageLimit) === null || _a === void 0 ? void 0 : _a.toString()) || 'Sin límite',
                code.validFrom,
                code.validUntil || 'Sin fecha límite'
            ];
            const csvRow = row.map(cell => `"${cell}"`).join(',');
            expect(csvRow).toBe('"SUMMER2024","Descuento de Verano","PERCENTAGE","20","ACTIVE","25","100","2024-01-01","2024-12-31"');
        });
        it('maneja códigos sin límite de uso', () => {
            var _a;
            const codeWithoutLimit = Object.assign(Object.assign({}, mockPromoCodes[0]), { usageLimit: undefined, validUntil: undefined });
            const row = [
                codeWithoutLimit.code,
                codeWithoutLimit.name,
                codeWithoutLimit.type,
                codeWithoutLimit.value.toString(),
                codeWithoutLimit.status,
                codeWithoutLimit.usedCount.toString(),
                ((_a = codeWithoutLimit.usageLimit) === null || _a === void 0 ? void 0 : _a.toString()) || 'Sin límite',
                codeWithoutLimit.validFrom,
                codeWithoutLimit.validUntil || 'Sin fecha límite'
            ];
            const csvRow = row.map(cell => `"${cell}"`).join(',');
            expect(csvRow).toBe('"SUMMER2024","Descuento de Verano","PERCENTAGE","20","ACTIVE","25","Sin límite","2024-01-01","Sin fecha límite"');
        });
    });
    describe('Funciones de formato de descuento', () => {
        it('formatea descuentos porcentuales correctamente', () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            expect(formatDiscount('PERCENTAGE', 20)).toBe('20%');
            expect(formatDiscount('PERCENTAGE', 15.5)).toBe('15.5%');
        });
        it('formatea descuentos de monto fijo correctamente', () => {
            const formatDiscount = (type, value) => type === 'PERCENTAGE' ? `${value}%` : `$${value.toLocaleString()}`;
            // Los números se formatean según la configuración regional
            // En entorno de test, puede usar punto o coma como separador
            const formatted10k = formatDiscount('FIXED_AMOUNT', 10000);
            const formatted5500 = formatDiscount('FIXED_AMOUNT', 5500);
            // Verificar que contiene el símbolo de moneda y el valor
            expect(formatted10k).toContain('$');
            expect(formatted10k).toContain('10');
            expect(formatted5500).toBe('$5500'); // 4 dígitos no tienen separador
        });
    });
    describe('Simulación de descarga de CSV', () => {
        it('simula la creación de blob y descarga', () => {
            const csvContent = 'header1,header2\nvalue1,value2';
            // Crear blob para el CSV
            new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            // Simular creación de elementos DOM
            const mockLink = {
                setAttribute: jest.fn(),
                click: jest.fn(),
                style: { visibility: 'hidden' },
            };
            // Mock del proceso de descarga
            const createElementSpy = jest.spyOn(document, 'createElement').mockReturnValue(mockLink);
            const appendChildSpy = jest.spyOn(document.body, 'appendChild').mockImplementation();
            const removeChildSpy = jest.spyOn(document.body, 'removeChild').mockImplementation();
            // Simular el proceso de descarga directamente
            const element = document.createElement('a');
            element.setAttribute('href', 'blob:mock-url');
            element.setAttribute('download', 'test.csv');
            element.style.visibility = 'hidden';
            // Simular append, click, remove
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            // Verificar que las funciones del mock funcionan
            expect(mockLink.setAttribute).toBeDefined();
            expect(mockLink.click).toBeDefined();
            // Limpiar mocks
            createElementSpy.mockRestore();
            appendChildSpy.mockRestore();
            removeChildSpy.mockRestore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxCaWx1clxcRG9jdW1lbnRzXFxEZXZlbG9wbWVudFxcTmV4dFxcc29yeWNrLWFjY2Vzc1xcc3JjXFxfX3Rlc3RzX19cXGhvb2tzXFx1c2VQcm9tb0NvZGVTaGFyaW5nLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFJSCxhQUFhO0FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUhwQixtQ0FBK0I7QUFJL0IsTUFBTSxTQUFTLEdBQUcsY0FBa0MsQ0FBQztBQUVyRCwyQkFBMkI7QUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUU7SUFDdkIsU0FBUyxFQUFFO1FBQ1QsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDakU7SUFDRCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztDQUM3RCxDQUFDLENBQUM7QUFFSCxzQkFBc0I7QUFDdEIsTUFBTSxjQUFjLEdBQUc7SUFDckI7UUFDRSxFQUFFLEVBQUUsR0FBRztRQUNQLElBQUksRUFBRSxZQUFZO1FBQ2xCLElBQUksRUFBRSxxQkFBcUI7UUFDM0IsSUFBSSxFQUFFLFlBQXFCO1FBQzNCLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLFFBQWlCO1FBQ3pCLFNBQVMsRUFBRSxFQUFFO1FBQ2IsVUFBVSxFQUFFLEdBQUc7UUFDZixRQUFRLEVBQUUsS0FBSztRQUNmLFNBQVMsRUFBRSxZQUFZO1FBQ3ZCLFVBQVUsRUFBRSxZQUFZO0tBQ3pCO0lBQ0Q7UUFDRSxFQUFFLEVBQUUsR0FBRztRQUNQLElBQUksRUFBRSxVQUFVO1FBQ2hCLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsSUFBSSxFQUFFLGNBQXVCO1FBQzdCLEtBQUssRUFBRSxLQUFL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QUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ25DLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNoQixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuQyxpREFBaUQ7WUFDakQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM1QyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXJDLGdCQUFnQjtZQUNoQixnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMvQixjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0IsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJpbHVyXFxEb2N1bWVudHNcXERldmVsb3BtZW50XFxOZXh0XFxzb3J5Y2stYWNjZXNzXFxzcmNcXF9fdGVzdHNfX1xcaG9va3NcXHVzZVByb21vQ29kZVNoYXJpbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVGVzdHMgcGFyYSBsYXMgZnVuY2lvbmFsaWRhZGVzIGRlIGNvbXBhcnRpciBjw7NkaWdvcyBwcm9tb2Npb25hbGVzXHJcbiAqIFRlc3RzIHNpbXBsaWZpY2Fkb3MgcXVlIG5vIGRlcGVuZGVuIGRlIGhvb2tzIGRlIFJlYWN0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgdG9hc3QgfSBmcm9tICdzb25uZXInO1xyXG5cclxuLy8gTW9jayB0b2FzdFxyXG5qZXN0Lm1vY2soJ3Nvbm5lcicpO1xyXG5jb25zdCBtb2NrVG9hc3QgPSB0b2FzdCBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgdG9hc3Q+O1xyXG5cclxuLy8gTW9jayBuYXZpZ2F0b3IgY2xpcGJvYXJkXHJcbk9iamVjdC5hc3NpZ24obmF2aWdhdG9yLCB7XHJcbiAgY2xpcGJvYXJkOiB7XHJcbiAgICB3cml0ZVRleHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpLFxyXG4gIH0sXHJcbiAgc2hhcmU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpLFxyXG59KTtcclxuXHJcbi8vIE1vY2sgUHJvbW9Db2RlIGRhdGFcclxuY29uc3QgbW9ja1Byb21vQ29kZXMgPSBbXHJcbiAge1xyXG4gICAgaWQ6ICcxJyxcclxuICAgIGNvZGU6ICdTVU1NRVIyMDI0JyxcclxuICAgIG5hbWU6ICdEZXNjdWVudG8gZGUgVmVyYW5vJyxcclxuICAgIHR5cGU6ICdQRVJDRU5UQUdFJyBhcyBjb25zdCxcclxuICAgIHZhbHVlOiAyMCxcclxuICAgIHN0YXR1czogJ0FDVElWRScgYXMgY29uc3QsXHJcbiAgICB1c2VkQ291bnQ6IDI1LFxyXG4gICAgdXNhZ2VMaW1pdDogMTAwLFxyXG4gICAgY3VycmVuY3k6ICdDTFAnLFxyXG4gICAgdmFsaWRGcm9tOiAnMjAyNC0wMS0wMScsXHJcbiAgICB2YWxpZFVudGlsOiAnMjAyNC0xMi0zMScsXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJzInLFxyXG4gICAgY29kZTogJ0ZJWEVEMTBLJyxcclxuICAgIG5hbWU6ICdEZXNjdWVudG8gRmlqbycsXHJcbiAgICB0eXBlOiAnRklYRURfQU1PVU5UJyBhcyBjb25zdCxcclxuICAgIHZhbHVlOiAxMDAwMCxcclxuICAgIHN0YXR1czogJ0lOQUNUSVZFJyBhcyBjb25zdCxcclxuICAgIHVzZWRDb3VudDogNTAsXHJcbiAgICB1c2FnZUxpbWl0OiA1MCxcclxuICAgIGN1cnJlbmN5OiAnQ0xQJyxcclxuICAgIHZhbGlkRnJvbTogJzIwMjQtMDEtMDEnLFxyXG4gICAgdmFsaWRVbnRpbDogJzIwMjQtMDYtMzAnLFxyXG4gIH0sXHJcbl07XHJcblxyXG5kZXNjcmliZSgnRnVuY2lvbmFsaWRhZGVzIGRlIENvbXBhcnRpciBDw7NkaWdvcyBQcm9tb2Npb25hbGVzJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDb21wYXJ0aXIgY29uIFdlYiBTaGFyZSBBUEknLCAoKSA9PiB7XHJcbiAgICBpdCgnY29tcGFydGUgY8OzZGlnbyBwcm9tb2Npb25hbCBjb24gV2ViIFNoYXJlIEFQSSBkaXNwb25pYmxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmb3JtYXREaXNjb3VudCA9ICh0eXBlOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpID0+IFxyXG4gICAgICAgIHR5cGUgPT09ICdQRVJDRU5UQUdFJyA/IGAke3ZhbHVlfSVgIDogYCQke3ZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9YDtcclxuXHJcbiAgICAgIGNvbnN0IGNvZGUgPSBtb2NrUHJvbW9Db2Rlc1swXTtcclxuICAgICAgY29uc3Qgc2hhcmVUZXh0ID0gYPCfjqsgwqFEZXNjdWVudG8gZXNwZWNpYWwhIFVzYSBlbCBjw7NkaWdvICR7Y29kZS5jb2RlfSB5IG9idMOpbiAke2Zvcm1hdERpc2NvdW50KGNvZGUudHlwZSwgY29kZS52YWx1ZSl9IGVuIHR1IHByw7N4aW1hIGNvbXByYS5gO1xyXG5cclxuICAgICAgaWYgKG5hdmlnYXRvci5zaGFyZSkge1xyXG4gICAgICAgIGF3YWl0IG5hdmlnYXRvci5zaGFyZSh7XHJcbiAgICAgICAgICB0aXRsZTogYEPDs2RpZ28gcHJvbW9jaW9uYWw6ICR7Y29kZS5uYW1lfWAsXHJcbiAgICAgICAgICB0ZXh0OiBzaGFyZVRleHQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGV4cGVjdChuYXZpZ2F0b3Iuc2hhcmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICB0aXRsZTogJ0PDs2RpZ28gcHJvbW9jaW9uYWw6IERlc2N1ZW50byBkZSBWZXJhbm8nLFxyXG4gICAgICAgIHRleHQ6ICfwn46rIMKhRGVzY3VlbnRvIGVzcGVjaWFsISBVc2EgZWwgY8OzZGlnbyBTVU1NRVIyMDI0IHkgb2J0w6luIDIwJSBlbiB0dSBwcsOzeGltYSBjb21wcmEuJyxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgndXNhIGNsaXBib2FyZCBjb21vIGZhbGxiYWNrIGN1YW5kbyBubyBoYXkgV2ViIFNoYXJlIEFQSScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gVGVtcG9yYWxtZW50ZSBlbGltaW5hciBXZWIgU2hhcmUgQVBJXHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsU2hhcmUgPSBuYXZpZ2F0b3Iuc2hhcmU7XHJcbiAgICAgIGRlbGV0ZSAobmF2aWdhdG9yIGFzIHVua25vd24gYXMgeyBzaGFyZT86IHR5cGVvZiBuYXZpZ2F0b3Iuc2hhcmUgfSkuc2hhcmU7XHJcblxyXG4gICAgICBjb25zdCBmb3JtYXREaXNjb3VudCA9ICh0eXBlOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpID0+IFxyXG4gICAgICAgIHR5cGUgPT09ICdQRVJDRU5UQUdFJyA/IGAke3ZhbHVlfSVgIDogYCQke3ZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9YDtcclxuXHJcbiAgICAgIGNvbnN0IGNvZGUgPSBtb2NrUHJvbW9Db2Rlc1swXTtcclxuICAgICAgY29uc3Qgc2hhcmVUZXh0ID0gYPCfjqsgwqFEZXNjdWVudG8gZXNwZWNpYWwhIFVzYSBlbCBjw7NkaWdvICR7Y29kZS5jb2RlfSB5IG9idMOpbiAke2Zvcm1hdERpc2NvdW50KGNvZGUudHlwZSwgY29kZS52YWx1ZSl9IGVuIHR1IHByw7N4aW1hIGNvbXByYS5gO1xyXG5cclxuICAgICAgaWYgKG5hdmlnYXRvci5zaGFyZSkge1xyXG4gICAgICAgIGF3YWl0IG5hdmlnYXRvci5zaGFyZSh7XHJcbiAgICAgICAgICB0aXRsZTogYEPDs2RpZ28gcHJvbW9jaW9uYWw6ICR7Y29kZS5uYW1lfWAsXHJcbiAgICAgICAgICB0ZXh0OiBzaGFyZVRleHQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoc2hhcmVUZXh0KTtcclxuICAgICAgICBtb2NrVG9hc3Quc3VjY2VzcygnVGV4dG8gZGUgcHJvbW9jacOzbiBjb3BpYWRvIGFsIHBvcnRhcGFwZWxlcycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBleHBlY3QobmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICfwn46rIMKhRGVzY3VlbnRvIGVzcGVjaWFsISBVc2EgZWwgY8OzZGlnbyBTVU1NRVIyMDI0IHkgb2J0w6luIDIwJSBlbiB0dSBwcsOzeGltYSBjb21wcmEuJ1xyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobW9ja1RvYXN0LnN1Y2Nlc3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdUZXh0byBkZSBwcm9tb2Npw7NuIGNvcGlhZG8gYWwgcG9ydGFwYXBlbGVzJ1xyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gUmVzdGF1cmFyIFdlYiBTaGFyZSBBUElcclxuICAgICAgKG5hdmlnYXRvciBhcyB1bmtub3duIGFzIHsgc2hhcmU/OiB0eXBlb2YgbmF2aWdhdG9yLnNoYXJlIH0pLnNoYXJlID0gb3JpZ2luYWxTaGFyZTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnR2VuZXJhY2nDs24gZGUgQ1NWJywgKCkgPT4ge1xyXG4gICAgaXQoJ2dlbmVyYSBDU1YgY29uIGhlYWRlcnMgY29ycmVjdG9zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBoZWFkZXJzID0gWydDw7NkaWdvJywgJ05vbWJyZScsICdUaXBvJywgJ1ZhbG9yJywgJ0VzdGFkbycsICdVc2FkbycsICdMw61taXRlJywgJ1bDoWxpZG8gRGVzZGUnLCAnVsOhbGlkbyBIYXN0YSddO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY3N2SGVhZGVycyA9IGhlYWRlcnMubWFwKGggPT4gYFwiJHtofVwiYCkuam9pbignLCcpO1xyXG5cclxuICAgICAgZXhwZWN0KGNzdkhlYWRlcnMpLnRvQmUoJ1wiQ8OzZGlnb1wiLFwiTm9tYnJlXCIsXCJUaXBvXCIsXCJWYWxvclwiLFwiRXN0YWRvXCIsXCJVc2Fkb1wiLFwiTMOtbWl0ZVwiLFwiVsOhbGlkbyBEZXNkZVwiLFwiVsOhbGlkbyBIYXN0YVwiJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZ2VuZXJhIGZpbGFzIGRlIENTViBjb3JyZWN0YW1lbnRlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb2RlID0gbW9ja1Byb21vQ29kZXNbMF07XHJcbiAgICAgIGNvbnN0IHJvdyA9IFtcclxuICAgICAgICBjb2RlLmNvZGUsXHJcbiAgICAgICAgY29kZS5uYW1lLFxyXG4gICAgICAgIGNvZGUudHlwZSxcclxuICAgICAgICBjb2RlLnZhbHVlLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29kZS5zdGF0dXMsXHJcbiAgICAgICAgY29kZS51c2VkQ291bnQudG9TdHJpbmcoKSxcclxuICAgICAgICBjb2RlLnVzYWdlTGltaXQ/LnRvU3RyaW5nKCkgfHwgJ1NpbiBsw61taXRlJyxcclxuICAgICAgICBjb2RlLnZhbGlkRnJvbSxcclxuICAgICAgICBjb2RlLnZhbGlkVW50aWwgfHwgJ1NpbiBmZWNoYSBsw61taXRlJ1xyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgY3N2Um93ID0gcm93Lm1hcChjZWxsID0+IGBcIiR7Y2VsbH1cImApLmpvaW4oJywnKTtcclxuXHJcbiAgICAgIGV4cGVjdChjc3ZSb3cpLnRvQmUoJ1wiU1VNTUVSMjAyNFwiLFwiRGVzY3VlbnRvIGRlIFZlcmFub1wiLFwiUEVSQ0VOVEFHRVwiLFwiMjBcIixcIkFDVElWRVwiLFwiMjVcIixcIjEwMFwiLFwiMjAyNC0wMS0wMVwiLFwiMjAyNC0xMi0zMVwiJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnbWFuZWphIGPDs2RpZ29zIHNpbiBsw61taXRlIGRlIHVzbycsICgpID0+IHtcclxuICAgICAgY29uc3QgY29kZVdpdGhvdXRMaW1pdCA9IHtcclxuICAgICAgICAuLi5tb2NrUHJvbW9Db2Rlc1swXSxcclxuICAgICAgICB1c2FnZUxpbWl0OiB1bmRlZmluZWQgYXMgbnVtYmVyIHwgdW5kZWZpbmVkLFxyXG4gICAgICAgIHZhbGlkVW50aWw6IHVuZGVmaW5lZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByb3cgPSBbXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC5jb2RlLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQubmFtZSxcclxuICAgICAgICBjb2RlV2l0aG91dExpbWl0LnR5cGUsXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC52YWx1ZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQuc3RhdHVzLFxyXG4gICAgICAgIGNvZGVXaXRob3V0TGltaXQudXNlZENvdW50LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC51c2FnZUxpbWl0Py50b1N0cmluZygpIHx8ICdTaW4gbMOtbWl0ZScsXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC52YWxpZEZyb20sXHJcbiAgICAgICAgY29kZVdpdGhvdXRMaW1pdC52YWxpZFVudGlsIHx8ICdTaW4gZmVjaGEgbMOtbWl0ZSdcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IGNzdlJvdyA9IHJvdy5tYXAoY2VsbCA9PiBgXCIke2NlbGx9XCJgKS5qb2luKCcsJyk7XHJcblxyXG4gICAgICBleHBlY3QoY3N2Um93KS50b0JlKCdcIlNVTU1FUjIwMjRcIixcIkRlc2N1ZW50byBkZSBWZXJhbm9cIixcIlBFUkNFTlRBR0VcIixcIjIwXCIsXCJBQ1RJVkVcIixcIjI1XCIsXCJTaW4gbMOtbWl0ZVwiLFwiMjAyNC0wMS0wMVwiLFwiU2luIGZlY2hhIGzDrW1pdGVcIicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdGdW5jaW9uZXMgZGUgZm9ybWF0byBkZSBkZXNjdWVudG8nLCAoKSA9PiB7XHJcbiAgICBpdCgnZm9ybWF0ZWEgZGVzY3VlbnRvcyBwb3JjZW50dWFsZXMgY29ycmVjdGFtZW50ZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZm9ybWF0RGlzY291bnQgPSAodHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSA9PiBcclxuICAgICAgICB0eXBlID09PSAnUEVSQ0VOVEFHRScgPyBgJHt2YWx1ZX0lYCA6IGAkJHt2YWx1ZS50b0xvY2FsZVN0cmluZygpfWA7XHJcblxyXG4gICAgICBleHBlY3QoZm9ybWF0RGlzY291bnQoJ1BFUkNFTlRBR0UnLCAyMCkpLnRvQmUoJzIwJScpO1xyXG4gICAgICBleHBlY3QoZm9ybWF0RGlzY291bnQoJ1BFUkNFTlRBR0UnLCAxNS41KSkudG9CZSgnMTUuNSUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdmb3JtYXRlYSBkZXNjdWVudG9zIGRlIG1vbnRvIGZpam8gY29ycmVjdGFtZW50ZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZm9ybWF0RGlzY291bnQgPSAodHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSA9PiBcclxuICAgICAgICB0eXBlID09PSAnUEVSQ0VOVEFHRScgPyBgJHt2YWx1ZX0lYCA6IGAkJHt2YWx1ZS50b0xvY2FsZVN0cmluZygpfWA7XHJcblxyXG4gICAgICAvLyBMb3MgbsO6bWVyb3Mgc2UgZm9ybWF0ZWFuIHNlZ8O6biBsYSBjb25maWd1cmFjacOzbiByZWdpb25hbFxyXG4gICAgICAvLyBFbiBlbnRvcm5vIGRlIHRlc3QsIHB1ZWRlIHVzYXIgcHVudG8gbyBjb21hIGNvbW8gc2VwYXJhZG9yXHJcbiAgICAgIGNvbnN0IGZvcm1hdHRlZDEwayA9IGZvcm1hdERpc2NvdW50KCdGSVhFRF9BTU9VTlQnLCAxMDAwMCk7XHJcbiAgICAgIGNvbnN0IGZvcm1hdHRlZDU1MDAgPSBmb3JtYXREaXNjb3VudCgnRklYRURfQU1PVU5UJywgNTUwMCk7XHJcblxyXG4gICAgICAvLyBWZXJpZmljYXIgcXVlIGNvbnRpZW5lIGVsIHPDrW1ib2xvIGRlIG1vbmVkYSB5IGVsIHZhbG9yXHJcbiAgICAgIGV4cGVjdChmb3JtYXR0ZWQxMGspLnRvQ29udGFpbignJCcpO1xyXG4gICAgICBleHBlY3QoZm9ybWF0dGVkMTBrKS50b0NvbnRhaW4oJzEwJyk7XHJcbiAgICAgIGV4cGVjdChmb3JtYXR0ZWQ1NTAwKS50b0JlKCckNTUwMCcpOyAvLyA0IGTDrWdpdG9zIG5vIHRpZW5lbiBzZXBhcmFkb3JcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnU2ltdWxhY2nDs24gZGUgZGVzY2FyZ2EgZGUgQ1NWJywgKCkgPT4ge1xyXG4gICAgaXQoJ3NpbXVsYSBsYSBjcmVhY2nDs24gZGUgYmxvYiB5IGRlc2NhcmdhJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gJ2hlYWRlcjEsaGVhZGVyMlxcbnZhbHVlMSx2YWx1ZTInO1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXIgYmxvYiBwYXJhIGVsIENTVlxyXG4gICAgICBuZXcgQmxvYihbY3N2Q29udGVudF0sIHsgdHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7JyB9KTtcclxuXHJcbiAgICAgIC8vIFNpbXVsYXIgY3JlYWNpw7NuIGRlIGVsZW1lbnRvcyBET01cclxuICAgICAgY29uc3QgbW9ja0xpbmsgPSB7XHJcbiAgICAgICAgc2V0QXR0cmlidXRlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgY2xpY2s6IGplc3QuZm4oKSxcclxuICAgICAgICBzdHlsZTogeyB2aXNpYmlsaXR5OiAnaGlkZGVuJyB9LFxyXG4gICAgICB9IGFzIHVua25vd24gYXMgSFRNTEFuY2hvckVsZW1lbnQ7XHJcblxyXG4gICAgICAvLyBNb2NrIGRlbCBwcm9jZXNvIGRlIGRlc2NhcmdhXHJcbiAgICAgIGNvbnN0IGNyZWF0ZUVsZW1lbnRTcHkgPSBqZXN0LnNweU9uKGRvY3VtZW50LCAnY3JlYXRlRWxlbWVudCcpLm1vY2tSZXR1cm5WYWx1ZShtb2NrTGluayk7XHJcbiAgICAgIGNvbnN0IGFwcGVuZENoaWxkU3B5ID0gamVzdC5zcHlPbihkb2N1bWVudC5ib2R5LCAnYXBwZW5kQ2hpbGQnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcclxuICAgICAgY29uc3QgcmVtb3ZlQ2hpbGRTcHkgPSBqZXN0LnNweU9uKGRvY3VtZW50LmJvZHksICdyZW1vdmVDaGlsZCcpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG5cclxuICAgICAgLy8gU2ltdWxhciBlbCBwcm9jZXNvIGRlIGRlc2NhcmdhIGRpcmVjdGFtZW50ZVxyXG4gICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsICdibG9iOm1vY2stdXJsJyk7XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsICd0ZXN0LmNzdicpO1xyXG4gICAgICBlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgXHJcbiAgICAgIC8vIFNpbXVsYXIgYXBwZW5kLCBjbGljaywgcmVtb3ZlXHJcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgIGVsZW1lbnQuY2xpY2soKTtcclxuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtZW50KTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhciBxdWUgbGFzIGZ1bmNpb25lcyBkZWwgbW9jayBmdW5jaW9uYW5cclxuICAgICAgZXhwZWN0KG1vY2tMaW5rLnNldEF0dHJpYnV0ZSkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KG1vY2tMaW5rLmNsaWNrKS50b0JlRGVmaW5lZCgpO1xyXG5cclxuICAgICAgLy8gTGltcGlhciBtb2Nrc1xyXG4gICAgICBjcmVhdGVFbGVtZW50U3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgIGFwcGVuZENoaWxkU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgIHJlbW92ZUNoaWxkU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==