{"file":"C:\\Users\\Bilur\\Documents\\Development\\Next\\soryck-access\\src\\hooks\\usePromoCode.ts","mappings":"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","names":[],"sources":["C:\\Users\\Bilur\\Documents\\Development\\Next\\soryck-access\\src\\hooks\\usePromoCode.ts"],"sourcesContent":["/**\r\n * Hooks personalizados para códigos promocionales\r\n * Extrae lógica reutilizable del componente\r\n */\r\n\r\nimport { useState, useMemo } from 'react';\r\nimport { toast } from 'sonner';\r\nimport type { PromoCode, PromoCodeFilters } from '@/types';\r\n\r\n// ============================================================================\r\n// HOOK PARA MANEJO DE ESTADO DE CÓDIGOS PROMOCIONALES\r\n// ============================================================================\r\n\r\nexport function usePromoCodeManagement(initialPromoCodes: PromoCode[]) {\r\n  const [promoCodes, setPromoCodes] = useState<PromoCode[]>(initialPromoCodes);\r\n  const [loadingStates, setLoadingStates] = useState<Record<string, boolean>>({});\r\n\r\n  const togglePromoCodeStatus = async (promoCode: PromoCode) => {\r\n    const newStatus = promoCode.status === \"ACTIVE\" ? \"INACTIVE\" : \"ACTIVE\";\r\n    const action = newStatus === \"ACTIVE\" ? \"activar\" : \"desactivar\";\r\n    \r\n    setLoadingStates(prev => ({ ...prev, [promoCode.id]: true }));\r\n\r\n    try {\r\n      const response = await fetch(`/api/promo-codes/${promoCode.id}/toggle-status`, {\r\n        method: \"PATCH\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ status: newStatus }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json();\r\n        throw new Error(data.error || `Error al ${action} el código promocional`);\r\n      }\r\n\r\n      // Actualizar el estado local\r\n      setPromoCodes(prev => \r\n        prev.map(code => \r\n          code.id === promoCode.id \r\n            ? { ...code, status: newStatus }\r\n            : code\r\n        )\r\n      );\r\n\r\n      toast.success(`Código promocional ${action === \"activar\" ? \"activado\" : \"desactivado\"} exitosamente`);\r\n    } catch (error) {\r\n      console.error(`Error ${action} promo code:`, error);\r\n      toast.error(error instanceof Error ? error.message : `Error al ${action} el código promocional`);\r\n    } finally {\r\n      setLoadingStates(prev => ({ ...prev, [promoCode.id]: false }));\r\n    }\r\n  };\r\n\r\n  const copyToClipboard = (code: string) => {\r\n    navigator.clipboard.writeText(code);\r\n    toast.success(\"Código copiado al portapapeles\");\r\n  };\r\n\r\n  return {\r\n    promoCodes,\r\n    loadingStates,\r\n    togglePromoCodeStatus,\r\n    copyToClipboard,\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// HOOK PARA FILTRADO DE CÓDIGOS PROMOCIONALES\r\n// ============================================================================\r\n\r\nexport function usePromoCodeFilters(promoCodes: PromoCode[]) {\r\n  const [filters, setFilters] = useState<PromoCodeFilters>({\r\n    search: \"\",\r\n    status: \"all\",\r\n  });\r\n\r\n  const filteredPromoCodes = useMemo(() => {\r\n    return promoCodes.filter((code) => {\r\n      const matchesSearch = !filters.search || \r\n        code.code.toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        code.name.toLowerCase().includes(filters.search.toLowerCase());\r\n\r\n      const matchesStatus = filters.status === \"all\" || code.status === filters.status;\r\n\r\n      return matchesSearch && matchesStatus;\r\n    });\r\n  }, [promoCodes, filters]);\r\n\r\n  const updateFilter = <K extends keyof PromoCodeFilters>(\r\n    key: K, \r\n    value: PromoCodeFilters[K]\r\n  ) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setFilters({ search: \"\", status: \"all\" });\r\n  };\r\n\r\n  return {\r\n    filters,\r\n    filteredPromoCodes,\r\n    updateFilter,\r\n    clearFilters,\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// HOOK PARA ESTADÍSTICAS DE CÓDIGOS PROMOCIONALES\r\n// ============================================================================\r\n\r\nexport function usePromoCodeStats(promoCodes: PromoCode[]) {\r\n  const stats = useMemo(() => {\r\n    const total = promoCodes.length;\r\n    const active = promoCodes.filter(code => code.status === \"ACTIVE\").length;\r\n    const totalUsages = promoCodes.reduce((sum, code) => sum + code.usedCount, 0);\r\n    const expired = promoCodes.filter(code => code.status === \"EXPIRED\").length;\r\n    const inactive = promoCodes.filter(code => code.status === \"INACTIVE\").length;\r\n    const usedUp = promoCodes.filter(code => code.status === \"USED_UP\").length;\r\n\r\n    return {\r\n      total,\r\n      active,\r\n      inactive,\r\n      expired,\r\n      usedUp,\r\n      totalUsages,\r\n      activePercentage: total > 0 ? (active / total) * 100 : 0,\r\n      usageRate: total > 0 ? (totalUsages / total) : 0,\r\n    };\r\n  }, [promoCodes]);\r\n\r\n  return stats;\r\n}\r\n\r\n// ============================================================================\r\n// HOOK PARA COMPARTIR CÓDIGOS PROMOCIONALES\r\n// ============================================================================\r\n\r\nexport function usePromoCodeSharing() {\r\n  const sharePromoCode = (code: PromoCode, formatDiscount: (type: string, value: number) => string) => {\r\n    const shareText = `🎫 ¡Descuento especial! Usa el código ${code.code} y obtén ${formatDiscount(code.type, code.value)} en tu próxima compra.`;\r\n\r\n    if (navigator.share) {\r\n      navigator.share({\r\n        title: `Código promocional: ${code.name}`,\r\n        text: shareText,\r\n      });\r\n    } else {\r\n      navigator.clipboard.writeText(shareText);\r\n      toast.success(\"Texto de promoción copiado al portapapeles\");\r\n    }\r\n  };\r\n\r\n  const exportPromoCodes = (promoCodes: PromoCode[]) => {\r\n    // Lógica para exportar códigos promocionales\r\n    const csv = generatePromoCodeCSV(promoCodes);\r\n    downloadCSV(csv, 'codigos-promocionales.csv');\r\n    toast.success(\"Códigos promocionales exportados exitosamente\");\r\n  };\r\n\r\n  return {\r\n    sharePromoCode,\r\n    exportPromoCodes,\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// UTILIDADES AUXILIARES\r\n// ============================================================================\r\n\r\nfunction generatePromoCodeCSV(promoCodes: PromoCode[]): string {\r\n  const headers = ['Código', 'Nombre', 'Tipo', 'Valor', 'Estado', 'Usado', 'Límite', 'Válido Desde', 'Válido Hasta'];\r\n  \r\n  const rows = promoCodes.map(code => [\r\n    code.code,\r\n    code.name,\r\n    code.type,\r\n    code.value.toString(),\r\n    code.status,\r\n    code.usedCount.toString(),\r\n    code.usageLimit?.toString() || 'Sin límite',\r\n    code.validFrom,\r\n    code.validUntil || 'Sin fecha límite'\r\n  ]);\r\n\r\n  return [headers, ...rows]\r\n    .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n    .join('\\n');\r\n}\r\n\r\nfunction downloadCSV(content: string, filename: string) {\r\n  const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  \r\n  if (link.download !== undefined) {\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', filename);\r\n    link.style.visibility = 'hidden';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }\r\n}\r\n"],"version":3}